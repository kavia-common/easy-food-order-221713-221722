{"is_source_file": true, "format": "TypeScript", "description": "This file provides services for managing and fetching review data related to restaurants and delivery personnel. It includes functions for fetching, submitting, and local storage handling of reviews, with network fallback to mock data.", "external_files": ["./api"], "external_methods": ["getApiBase"], "published": ["fetchRestaurantReviews", "submitRestaurantReview", "fetchDeliveryReviews", "submitDeliveryReview"], "classes": [], "methods": [{"name": "function safeGetItem(key: string): string | null { safeGetItem", "description": "Safely retrieve an item from localStorage, handling server-side rendering environments.", "scope": "", "scopeKind": ""}, {"name": "function safeSetItem(key: string, value: string) { safeSetItem", "description": "Safely set an item in localStorage, handling server-side rendering environments.", "scope": "", "scopeKind": ""}, {"name": "function computeSummary<T extends { rating: number }>(reviews: T[]): RatingSummary { computeSummary", "description": "Compute a rating summary (average, breakdown) from a list of reviews.", "scope": "", "scopeKind": ""}, {"name": "async function tryFetch<T>(input: RequestInfo, init?: RequestInit): Promise<T | null> { tryFetch", "description": "Attempt to fetch data from network; fallback returns null on failure.", "scope": "", "scopeKind": ""}, {"name": "function readRestaurantMap(): RestaurantReviewsMap { readRestaurantMap", "description": "Read restaurant reviews from localStorage mock.", "scope": "", "scopeKind": ""}, {"name": "function writeRestaurantMap(data: RestaurantReviewsMap) { writeRestaurantMap", "description": "Write restaurant reviews to localStorage mock.", "scope": "", "scopeKind": ""}, {"name": "function readDeliveryByPersonMap(): DeliveryReviewsByPersonMap { readDeliveryByPersonMap", "description": "Read delivery reviews by person from localStorage mock.", "scope": "", "scopeKind": ""}, {"name": "function writeDeliveryByPersonMap(data: DeliveryReviewsByPersonMap) { writeDeliveryByPersonMap", "description": "Write delivery reviews by person to localStorage mock.", "scope": "", "scopeKind": ""}, {"name": "function readDeliveryByOrderMap(): DeliveryReviewsByOrderMap { readDeliveryByOrderMap", "description": "Read delivery reviews by order from localStorage mock.", "scope": "", "scopeKind": ""}, {"name": "function writeDeliveryByOrderMap(data: DeliveryReviewsByOrderMap) { writeDeliveryByOrderMap", "description": "Write delivery reviews by order to localStorage mock.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchRestaurantReviews( fetchRestaurantReviews", "description": "Fetch reviews for a specific restaurant, with network and local fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function submitRestaurantReview( submitRestaurantReview", "description": "Submit a new review for a restaurant and update local mock storage.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchDeliveryReviews( fetchDeliveryReviews", "description": "Fetch delivery reviews either by delivery person or order with fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function submitDeliveryReview( submitDeliveryReview", "description": "Submit a delivery review and update local mock storage, including associations.", "scope": "", "scopeKind": ""}, {"name": "function cryptoRandomId() { cryptoRandomId", "description": "Generate a pseudo-random ID, using crypto if available.", "scope": "", "scopeKind": ""}], "calls": ["getApiBase", "fetch", "JSON.parse", "JSON.stringify", "window.localStorage.getItem", "window.localStorage.setItem"], "search-terms": ["ratingsApi", "fetchRestaurantReviews", "submitRestaurantReview", "fetchDeliveryReviews", "submitDeliveryReview", "localStorage", "review", "ratingSummary", "DeliveryReview", "RestaurantReview"], "state": 2, "file_id": 30, "knowledge_revision": 102, "git_revision": "", "revision_history": [{"91": ""}, {"96": ""}, {"99": ""}, {"101": ""}, {"102": ""}], "ctags": [{"_type": "tag", "name": "DeliveryReviewsByOrderMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^type DeliveryReviewsByOrderMap = Record<string, DeliveryReview>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "DeliveryReviewsByPersonMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^type DeliveryReviewsByPersonMap = Record<string, DeliveryReview[]>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "LS_KEYS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^const LS_KEYS = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "RestaurantReviewsMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^type RestaurantReviewsMap = Record<string, RestaurantReview[]>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "anyCrypto", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const anyCrypto = crypto as unknown as { randomUUID?: () => string };$/", "language": "TypeScript", "kind": "constant", "scope": "cryptoRandomId", "scopeKind": "function"}, {"_type": "tag", "name": "apiBase", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const apiBase = getApiBase();$/", "language": "TypeScript", "kind": "constant", "scope": "tryFetch", "scopeKind": "function"}, {"_type": "tag", "name": "breakdown", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const breakdown = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 } as RatingSummary['breakdown'];$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "bucket", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const bucket = Math.max(1, Math.min(5, Math.round(r.rating)));$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "byOrder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const byOrder = readDeliveryByOrderMap();$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "byPerson", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const byPerson = readDeliveryByPersonMap();$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "computeSummary", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function computeSummary<T extends { rating: number }>(reviews: T[]): RatingSummary {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const count = reviews.length;$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "cryptoRandomId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function cryptoRandomId() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchDeliveryReviews", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^export async function fetchDeliveryReviews($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchRestaurantReviews", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^export async function fetchRestaurantReviews($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const list = (personMap[params.deliveryPersonId] || []).sort((a, b) =>$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const list = review ? [review] : [];$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const list = (map[restaurantId] || []).sort((a, b) => (a.createdAt < b.createdAt ? 1 : -1));$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "map", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const map = readRestaurantMap();$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "map", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const map = readRestaurantMap();$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "net", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const net = await tryFetch<DeliveryReview>(`\\/ratings\\/delivery`, {$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "net", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const net = await tryFetch<RestaurantReview>(`\\/ratings\\/restaurant`, {$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "net", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const net = await tryFetch<ReviewListResponse<DeliveryReview>>($/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "net", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const net = await tryFetch<ReviewListResponse<RestaurantReview>>($/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const now = new Date().toISOString();$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const now = new Date().toISOString();$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "orderMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const orderMap = readDeliveryByOrderMap();$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "params", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const review = orderMap[params.orderId];$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "personMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const personMap = readDeliveryByPersonMap();$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "qs", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const qs =$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "r", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  for (const r of reviews) {$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const raw = safeGetItem(LS_KEYS.deliveryReviewsByOrder);$/", "language": "TypeScript", "kind": "constant", "scope": "readDeliveryByOrderMap", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const raw = safeGetItem(LS_KEYS.deliveryReviewsByPerson);$/", "language": "TypeScript", "kind": "constant", "scope": "readDeliveryByPersonMap", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const raw = safeGetItem(LS_KEYS.restaurantReviews);$/", "language": "TypeScript", "kind": "constant", "scope": "readRestaurantMap", "scopeKind": "function"}, {"_type": "tag", "name": "readDeliveryByOrderMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function readDeliveryByOrderMap(): DeliveryReviewsByOrderMap {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "readDeliveryByPersonMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function readDeliveryByPersonMap(): DeliveryReviewsByPersonMap {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "readRestaurantMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function readRestaurantMap(): RestaurantReviewsMap {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const res = await fetch(typeof input === 'string' ? `${apiBase}${input}` : input, init);$/", "language": "TypeScript", "kind": "constant", "scope": "tryFetch", "scopeKind": "function"}, {"_type": "tag", "name": "review", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const list = review ? [review] : [];$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "review", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^    const review = orderMap[params.orderId];$/", "language": "TypeScript", "kind": "constant", "scope": "fetchDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "review", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const review: DeliveryReview = {$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "review", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const review: RestaurantReview = {$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "reviews", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^  const reviews = list.slice(0, limit);$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "safeGetItem", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function safeGetItem(key: string): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "safeSetItem", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function safeSetItem(key: string, value: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "submitDeliveryReview", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^export async function submitDeliveryReview($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "submitRestaurantReview", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^export async function submitRestaurantReview($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "tryFetch", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^async function tryFetch<T>(input: RequestInfo, init?: RequestInit): Promise<T | null> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "writeDeliveryByOrderMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function writeDeliveryByOrderMap(data: DeliveryReviewsByOrderMap) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "writeDeliveryByPersonMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function writeDeliveryByPersonMap(data: DeliveryReviewsByPersonMap) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "writeRestaurantMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratingsApi.ts", "pattern": "/^function writeRestaurantMap(data: RestaurantReviewsMap) {$/", "language": "TypeScript", "kind": "function"}], "hash": "1b58f9cb9b5a377bed7d4a8fbb43844c", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/ratingsApi.ts"}