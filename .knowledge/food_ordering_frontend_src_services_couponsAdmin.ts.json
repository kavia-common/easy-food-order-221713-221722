{"is_source_file": true, "format": "TypeScript", "description": "This file provides services related to coupon management in a food ordering frontend aplikasi. It includes functions to read/write coupons from local storage, fetch/update coupons via API (fallback to local storage if API not available), normalize coupon data, validate coupon applicability based on various criteria, and record coupon usage. The file defines external dependencies such as fetch API, local storage, and types related to coupons.", "external_files": ["./pricing", "./api", "@/types/coupons"], "external_methods": ["fetch", "JSON.parse", "JSON.stringify", "crypto.randomUUID", "Math.max", "Math.floor", "Date.now"], "published": ["listCoupons", "createCoupon", "updateCoupon", "toggleCoupon", "isExpired", "couponMeetsSubtotal", "validateCouponWithContext", "findByCode", "recordUsage"], "classes": [], "methods": [{"name": "export function normalizeCoupon(c: Coupon): Coupon { normalizeCoupon", "description": "Normalizes coupon properties for consistent behavior, adjusting numerical fields and filtering arrays.", "scope": "", "scopeKind": ""}, {"name": "export async function listCoupons(): Promise<Coupon[]> { listCoupons", "description": "Fetches the list of coupons, either from an API or local storage fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function createCoupon(input: CouponCreateInput): Promise<Coupon> { createCoupon", "description": "Creates a new coupon, adding it to local storage or via API fallback, and checks for duplicate codes.", "scope": "", "scopeKind": ""}, {"name": "export async function updateCoupon(id: string, patch: CouponUpdatePatch): Promise<Coupon> { updateCoupon", "description": "Updates an existing coupon by ID, either via API or local storage fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function toggleCoupon(id: string, active: boolean): Promise<Coupon> { toggleCoupon", "description": "Enables or disables a coupon quickly.", "scope": "", "scopeKind": ""}, {"name": "export function isExpired(expiresAt?: string): boolean { isExpired", "description": "Checks if a coupon has expired based on its expiry date.", "scope": "", "scopeKind": ""}, {"name": "export function couponMeetsSubtotal(subtotal: number, coupon?: Coupon | null): boolean { couponMeetsSubtotal", "description": "Verifies if a subtotal satisfies the minimum subtotal requirement of a coupon.", "scope": "", "scopeKind": ""}, {"name": "export function validateCouponWithContext(coupon: Coupon, ctx: CouponValidationContext): { valid/ validateCouponWithContext", "description": "Validates whether a coupon can be applied based on various criteria such as activity status, expiration, scope, usage limits, and subtotal.", "scope": "", "scopeKind": ""}, {"name": "export async function findByCode(code: string): Promise<Coupon | null> { findByCode", "description": "Finds a coupon by code in a case-insensitive manner.", "scope": "", "scopeKind": ""}, {"name": "export async function recordUsage(coupon: Coupon, ctx: CouponValidationContext) { recordUsage", "description": "Records the usage of a coupon, updating counts globally and per restaurant in local storage.", "scope": "", "scopeKind": ""}, {"name": "function allItemsMatchScope(cartRids: string[], coupon: Coupon): boolean { allItemsMatchScope", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function cartHasRestaurantMatch(ctx: CouponValidationContext, coupon: Coupon): boolean { cartHasRestaurantMatch", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function getCartRestaurantIds(ctx: CouponValidationContext): string[] { getCartRestaurantIds", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function idGen(): string { idGen", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function readAll(): Coupon[] { readAll", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function readUsageByRestaurant(): Record<string, number> { readUsageByRestaurant", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function safeStorage(): Storage | null { safeStorage", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function seedDefaults(): Coupon[] { seedDefaults", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function writeAll(list: Coupon[]) { writeAll", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function writeUsageByRestaurant(map: Record<string, number>) { writeUsageByRestaurant", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetch", "JSON.parse", "JSON.stringify", "crypto.randomUUID", "normalizeCoupon", "readAll", "writeAll", "getApiBase", "readUsageByRestaurant", "writeUsageByRestaurant"], "search-terms": ["coupons management", "localStorage coupon cache", "coupon validation", "coupon creation", "coupon update", "coupon list API", "coupon usage tracking", "coupon expiration"], "state": 2, "file_id": 60, "knowledge_revision": 267, "git_revision": "84cd23df1bf003a74725e747a3045bda2c8d64b7", "ctags": [{"_type": "tag", "name": "LS_KEYS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^const LS_KEYS = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const all = readAll()$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const all = readAll()$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const all = readAll()$/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "allItemsMatchScope", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function allItemsMatchScope(cartRids: string[], coupon: Coupon): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "listCoupons", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const base = {$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "cartHasRestaurantMatch", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function cartHasRestaurantMatch(ctx: CouponValidationContext, coupon: Coupon): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "cartR", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const cartR = (ctx.restaurantIds && ctx.restaurantIds.length ? ctx.restaurantIds : (ctx.restau/", "language": "TypeScript", "kind": "constant", "scope": "cartHasRestaurantMatch", "scopeKind": "function"}, {"_type": "tag", "name": "cartRids", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const cartRids = getCartRestaurantIds(ctx)$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "cartRids", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const cartRids = getCartRestaurantIds(ctx)$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "const", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const next = [...all, created]$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "couponMeetsSubtotal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export function couponMeetsSubtotal(subtotal: number, coupon?: Coupon | null): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "createCoupon", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export async function createCoupon(input: CouponCreateInput): Promise<Coupon> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "created", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const created: Coupon = normalizeCoupon({$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "created", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const next = [...all, created]$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^        const data = (await res.json()) as Coupon$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^        const data = (await res.json()) as Coupon$/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^        const data = (await res.json()) as Coupon[]$/", "language": "TypeScript", "kind": "constant", "scope": "listCoupons", "scopeKind": "function"}, {"_type": "tag", "name": "exists", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const exists = all.some((c) => c.code.trim().toUpperCase() === input.code.trim().toUpperCase()/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "findByCode", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export async function findByCode(code: string): Promise<Coupon | null> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "found", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const found = list.find((c) => c.code.trim().toUpperCase() === norm)$/", "language": "TypeScript", "kind": "constant", "scope": "findByCode", "scopeKind": "function"}, {"_type": "tag", "name": "future", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const future = new Date(Date.now() + 365 * 24 * 3600 * 1000).toISOString()$/", "language": "TypeScript", "kind": "constant", "scope": "seedDefaults", "scopeKind": "function"}, {"_type": "tag", "name": "getCartRestaurantIds", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function getCartRestaurantIds(ctx: CouponValidationContext): string[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "idGen", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function idGen(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const updated = { ...all[idx], usedCount: (all[idx].usedCount ?? 0) + 1 }$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const idx = all.findIndex((c) => c.id === coupon.id)$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const idx = all.findIndex((c) => c.id === id)$/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "if", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^      if (res.ok) {$/", "language": "TypeScript", "kind": "constant", "scope": "listCoupons", "scopeKind": "function"}, {"_type": "tag", "name": "isExpired", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export function isExpired(expiresAt?: string): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const key = `${coupon.code}|${cartRids[0]}`$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const key = `${coupon.code}|${rid}`$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const used = map[key] ?? 0$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const list = await listCoupons()$/", "language": "TypeScript", "kind": "constant", "scope": "findByCode", "scopeKind": "function"}, {"_type": "tag", "name": "listCoupons", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export async function listCoupons(): Promise<Coupon[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "map", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const map = readUsageByRestaurant()$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "map", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const map = readUsageByRestaurant()$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "min", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const min = coupon.minSubtotal ?? 0$/", "language": "TypeScript", "kind": "constant", "scope": "couponMeetsSubtotal", "scopeKind": "function"}, {"_type": "tag", "name": "next", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const next = [...all, created]$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "next", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const next = [...all]$/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "norm", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const norm = code.trim().toUpperCase()$/", "language": "TypeScript", "kind": "constant", "scope": "findByCode", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeCoupon", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export function normalizeCoupon(c: Coupon): Coupon {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const parsed = JSON.parse(raw) as Coupon[]$/", "language": "TypeScript", "kind": "constant", "scope": "readAll", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const raw = store.getItem(LS_KEYS.COUPONS)$/", "language": "TypeScript", "kind": "constant", "scope": "readAll", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const raw = store.getItem(LS_KEYS.COUPON_USAGE_BY_RESTAURANT)$/", "language": "TypeScript", "kind": "constant", "scope": "readUsageByRestaurant", "scopeKind": "function"}, {"_type": "tag", "name": "readAll", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function readAll(): Coupon[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "readUsageByRestaurant", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function readUsageByRestaurant(): Record<string, number> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "recordUsage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export async function recordUsage(coupon: Coupon, ctx: CouponValidationContext) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^      const res = await fetch(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/coupons\\/${encodeURIComp/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^      const res = await fetch(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/coupons`, {$/", "language": "TypeScript", "kind": "constant", "scope": "createCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^      const res = await fetch(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/coupons`, {$/", "language": "TypeScript", "kind": "constant", "scope": "listCoupons", "scopeKind": "function"}, {"_type": "tag", "name": "rid", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const rid = cartRids[0]$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "safeStorage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function safeStorage(): Storage | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "seedDefaults", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function seedDefaults(): Coupon[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "seeded", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^      const seeded = seedDefaults()$/", "language": "TypeScript", "kind": "constant", "scope": "readAll", "scopeKind": "function"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const store = safeStorage()$/", "language": "TypeScript", "kind": "constant", "scope": "readAll", "scopeKind": "function"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const store = safeStorage()$/", "language": "TypeScript", "kind": "constant", "scope": "readUsageByRestaurant", "scopeKind": "function"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const store = safeStorage()$/", "language": "TypeScript", "kind": "constant", "scope": "writeAll", "scopeKind": "function"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const store = safeStorage()$/", "language": "TypeScript", "kind": "constant", "scope": "writeUsageByRestaurant", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const t = new Date(expiresAt).getTime()$/", "language": "TypeScript", "kind": "constant", "scope": "isExpired", "scopeKind": "function"}, {"_type": "tag", "name": "toggleCoupon", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export async function toggleCoupon(id: string, active: boolean): Promise<Coupon> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "updateCoupon", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export async function updateCoupon(id: string, patch: CouponUpdatePatch): Promise<Coupon> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const updated = { ...all[idx], usedCount: (all[idx].usedCount ?? 0) + 1 }$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^  const updated: Coupon = normalizeCoupon({$/", "language": "TypeScript", "kind": "constant", "scope": "updateCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "used", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const used = map[key] ?? 0$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "usedCount", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    const updated = { ...all[idx], usedCount: (all[idx].usedCount ?? 0) + 1 }$/", "language": "TypeScript", "kind": "constant", "scope": "recordUsage", "scopeKind": "function"}, {"_type": "tag", "name": "validateCouponWithContext", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^export function validateCouponWithContext(coupon: Coupon, ctx: CouponValidationContext): { valid/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "value", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^    value: safeRound2(Number(c.value)),$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeCoupon", "scopeKind": "function"}, {"_type": "tag", "name": "writeAll", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function writeAll(list: Coupon[]) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "writeUsageByRestaurant", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/couponsAdmin.ts", "pattern": "/^function writeUsageByRestaurant(map: Record<string, number>) {$/", "language": "TypeScript", "kind": "function"}], "hash": "63fbfd36454a41090bd0a547c692377e", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/couponsAdmin.ts", "revision_history": [{"267": "84cd23df1bf003a74725e747a3045bda2c8d64b7"}]}