{"is_source_file": true, "format": "TypeScript", "description": "This file defines API functions and data handling logic for managing subscription plans, user subscriptions, and related features in a frontend application. It includes mock data generation, local storage caching, and API interaction, specifically for subscription-related operations.", "external_files": ["@/types/subscriptions"], "external_methods": ["fetch"], "published": ["listPlans", "getCurrentSubscription", "subscribe", "cancelSubscription", "getPerks"], "classes": [], "methods": [{"name": "function safeGetItem(key: string): string | null { safeGetItem", "description": "Safely retrieves an item from localStorage, handling exceptions and environment restrictions.", "scope": "", "scopeKind": ""}, {"name": "function safeSetItem(key: string, value: string) { safeSetItem", "description": "Safely sets an item in localStorage, handling exceptions.", "scope": "", "scopeKind": ""}, {"name": "function now(): number { now", "description": "Returns the current timestamp.", "scope": "", "scopeKind": ""}, {"name": "function hasFreshCache(): boolean { hasFreshCache", "description": "Determines if the cache data is still valid based on timestamp.", "scope": "", "scopeKind": ""}, {"name": "function mockPlans(): SubscriptionPlan[] { mockPlans", "description": "Generates mock subscription plans with benefits for testing or fallback.", "scope": "", "scopeKind": ""}, {"name": "function defaultUserSubscription(): UserSubscription { defaultUserSubscription", "description": "Returns a default, empty user subscription object.", "scope": "", "scopeKind": ""}, {"name": "function persistPlans(plans: SubscriptionPlan[]) { persistPlans", "description": "Stores subscription plans and timestamp in localStorage.", "scope": "", "scopeKind": ""}, {"name": "function persistUserSub(sub: UserSubscription) { persistUserSub", "description": "Stores user subscription data in localStorage.", "scope": "", "scopeKind": ""}, {"name": "function loadPlansFromStorage(): SubscriptionPlan[] | null { loadPlansFromStorage", "description": "Loads and parses subscription plans from localStorage.", "scope": "", "scopeKind": ""}, {"name": "function loadUserSubFromStorage(): UserSubscription | null { loadUserSubFromStorage", "description": "Loads and parses user subscription data from localStorage.", "scope": "", "scopeKind": ""}, {"name": "function normalizeApiBase(v?: string): string | undefined { normalizeApiBase", "description": "Normalizes API base URL string, validating and removing trailing slashes.", "scope": "", "scopeKind": ""}, {"name": "async function fetchFromApi<T>(path: string): Promise<T> { fetchFromApi", "description": "Performs a fetch request to the API endpoint, handling URL normalization and response parsing.", "scope": "", "scopeKind": ""}, {"name": "export async function listPlans(): Promise<SubscriptionPlan[]> { listPlans", "description": "Fetches subscription plans either from cache, API, or generates mock data as fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function getCurrentSubscription(): Promise<UserSubscription> { getCurrentSubscription", "description": "Retrieves the current user subscription from API or local storage fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function subscribe(planId: string): Promise<UserSubscription> { subscribe", "description": "Subscribes to a plan by ID, updating local storage accordingly.", "scope": "", "scopeKind": ""}, {"name": "export async function cancelSubscription(): Promise<UserSubscription> { cancelSubscription", "description": "Cancels the current subscription, updating local cache to reflect cancellation.", "scope": "", "scopeKind": ""}, {"name": "export async function getPerks(): Promise<SubscriptionPerk[]> { getPerks", "description": "Provides the list of perks associated with the current subscription.", "scope": "", "scopeKind": ""}], "calls": ["fetchFromApi", "loadPlansFromStorage", "loadUserSubFromStorage", "persistPlans", "persistUserSub", "normalizeApiBase"], "search-terms": ["subscriptionsApi", "localStorage caching", "mock plans", "fetch API", "subscription plans", "user subscription", "fallback", "subscription perks"], "state": 2, "file_id": 36, "knowledge_revision": 200, "git_revision": "ef85c21ea4ed8dfbec99666038bc8f94558191b0", "revision_history": [{"122": ""}, {"191": "222638623460685c384db599cd7b795a0c3616d8"}, {"200": "ef85c21ea4ed8dfbec99666038bc8f94558191b0"}], "ctags": [{"_type": "tag", "name": "CACHE_TTL_MS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^const CACHE_TTL_MS = 5 * 60 * 1000; \\/\\/ 5 minutes$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "STORAGE_KEYS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^const STORAGE_KEYS = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "SubscriptionPerk", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^import { SubscriptionPerkType, type SubscriptionPerk, type SubscriptionPlan, type UserSubscripti/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SubscriptionPlan", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^import { SubscriptionPerkType, type SubscriptionPerk, type SubscriptionPlan, type UserSubscripti/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "UserSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^import { SubscriptionPerkType, type SubscriptionPerk, type SubscriptionPlan, type UserSubscripti/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const base = normalizeApiBase(import.meta.env.VITE_API_BASE as string | undefined) ||$/", "language": "TypeScript", "kind": "constant", "scope": "fetchFromApi", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const cached = loadPlansFromStorage();$/", "language": "TypeScript", "kind": "constant", "scope": "listPlans", "scopeKind": "function"}, {"_type": "tag", "name": "cancelSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function cancelSubscription(): Promise<UserSubscription> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "canceled", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const canceled: UserSubscription = {$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const current = await getCurrentSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "def", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const def = defaultUserSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "getCurrentSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "defaultUserSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function defaultUserSubscription(): UserSubscription {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.FreeDelivery, description: 'Free delivery on all orders', value/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.FreeDelivery, description: 'Free delivery on eligible orders', /", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.MealPlan, description: 'Monthly meal plan credits', value: 2000/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.VipDiscount, description: 'VIP discount on every order', value:/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "fetchFromApi", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^async function fetchFromApi<T>(path: string): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getCurrentSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function getCurrentSubscription(): Promise<UserSubscription> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getPerks", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function getPerks(): Promise<SubscriptionPerk[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "hasFreshCache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function hasFreshCache(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "listPlans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function listPlans(): Promise<SubscriptionPlan[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "loadPlansFromStorage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function loadPlansFromStorage(): SubscriptionPlan[] | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "loadUserSubFromStorage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function loadUserSubFromStorage(): UserSubscription | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "local", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const local = loadUserSubFromStorage();$/", "language": "TypeScript", "kind": "constant", "scope": "getCurrentSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "mockPlans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function mockPlans(): SubscriptionPlan[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const n = parseInt(ts, 10);$/", "language": "TypeScript", "kind": "constant", "scope": "hasFreshCache", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeApiBase", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function normalizeApiBase(v?: string): string | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function now(): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "perksBasic", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const perksBasic: SubscriptionPerk[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "perksMeal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const perksMeal: SubscriptionPerk[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "perksVip", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const perksVip: SubscriptionPerk[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "persistPlans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function persistPlans(plans: SubscriptionPlan[]) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "persistUserSub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function persistUserSub(sub: UserSubscription) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "plan", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plan = plans.find(p => p.id === planId);$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "plans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plans = (await listPlans()) || [];$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "plans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plans = await fetchFromApi<SubscriptionPlan[]>('\\/subscriptions\\/plans');$/", "language": "TypeScript", "kind": "constant", "scope": "listPlans", "scopeKind": "function"}, {"_type": "tag", "name": "plans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plans = mockPlans();$/", "language": "TypeScript", "kind": "constant", "scope": "listPlans", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const raw = safeGetItem(STORAGE_KEYS.plans);$/", "language": "TypeScript", "kind": "constant", "scope": "loadPlansFromStorage", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const raw = safeGetItem(STORAGE_KEYS.userSub);$/", "language": "TypeScript", "kind": "constant", "scope": "loadUserSubFromStorage", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const res = await fetch(url, { credentials: 'include' });$/", "language": "TypeScript", "kind": "constant", "scope": "fetchFromApi", "scopeKind": "function"}, {"_type": "tag", "name": "safeGetItem", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function safeGetItem(key: string): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "safeSetItem", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function safeSetItem(key: string, value: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^      status: 'active',$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^      status: current.planId ? 'canceled' : 'none',$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub = await fetchFromApi<UserSubscription>('\\/subscriptions\\/cancel');$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub = await fetchFromApi<UserSubscription>('\\/subscriptions\\/current');$/", "language": "TypeScript", "kind": "constant", "scope": "getCurrentSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub = await fetchFromApi<UserSubscription>(`\\/subscriptions\\/subscribe?planId=${encode/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub: UserSubscription = {$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const sub = await getCurrentSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "getPerks", "scopeKind": "function"}, {"_type": "tag", "name": "subscribe", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function subscribe(planId: string): Promise<UserSubscription> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ts", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const ts = safeGetItem(STORAGE_KEYS.cacheTs);$/", "language": "TypeScript", "kind": "constant", "scope": "hasFreshCache", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const url = `${base}${path}`;$/", "language": "TypeScript", "kind": "constant", "scope": "fetchFromApi", "scopeKind": "function"}], "hash": "cc6ddca4641e9cf3970917e792801806", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/subscriptionsApi.ts"}