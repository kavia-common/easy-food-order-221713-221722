{"is_source_file": true, "format": "TypeScript", "description": "This source file provides API service functions for a food ordering frontend application. It includes functions to fetch categories, items, a single item by ID, create orders, submit orders, fetch restaurants, and manages mock data fallback. It handles environment variables, caching, and API URL validation, and exposes some feature flags.", "external_files": ["@/types", "@/services/mockData", "./ordersApi"], "external_methods": ["import.meta.env.VITE_API_BASE", "import.meta.env.VITE_BACKEND_URL", "import.meta.env.VITE_FEATURE_FLAGS", "import('@/services/mockData')", "fetch()", "new URL()", "JSON.parse()", "setTimeout()"], "published": ["fetchCategories", "fetchItems", "fetchItemById", "createOrder", "submitOrder", "fetchRestaurants", "featureFlags"], "classes": [], "methods": [{"name": "function isValidBaseUrl(v: unknown): v is string { isValidBaseUrl", "description": "Utility to validate if a string is a valid URL or base URL.", "scope": "", "scopeKind": ""}, {"name": "export function getApiBase(): string | undefined { getApiBase", "description": "Retrieves the base URL for API from environment variables, if valid.", "scope": "", "scopeKind": ""}, {"name": "function getFlags(): Record<string, boolean> { getFlags", "description": "Parses feature flags from environment variables, supporting JSON or CSV format.", "scope": "", "scopeKind": ""}, {"name": "function shouldUseMock(): boolean { shouldUseMock", "description": "Determines whether to use mock data based on feature flags and API base availability.", "scope": "", "scopeKind": ""}, {"name": "async function importMock() { importMock", "description": "Dynamically imports the mock data module.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchCategories(restaurantId?: string): Promise<FoodCategory[]> { fetchCategories", "description": "Fetches food categories, optionally for a specific restaurant; uses cache and fallback to mock.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchItems( fetchItems", "description": "Fetches food items with optional category, search, and restaurant filters; uses cache and fallback to mock.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchItemById(itemId: string, restaurantId?: string): Promise<FoodItem | n/ fetchItemById", "description": "Fetches a single food item by ID, optionally scoped to a restaurant; uses cache and fallback to mock.", "scope": "", "scopeKind": ""}, {"name": "export async function createOrder(payload: OrderPayload): Promise<OrderResponse> { createOrder", "description": "Creates an order, with fallback to mock response.", "scope": "", "scopeKind": ""}, {"name": "export async function submitOrder(payload: OrderPayload): Promise<OrderResponse> { submitOrder", "description": "Backward-compatible wrapper that delegates to createOrder.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchRestaurants(query: RestaurantQuery = {}): Promise<Restaurant[]> { fetchRestaurants", "description": "Fetches list of restaurants with filtering and sorting, uses cache and fallback to mock.", "scope": "", "scopeKind": ""}, {"name": "async function mockOrderSuccess(): Promise<OrderResponse> { mockOrderSuccess", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function restaurantsKey(query: RestaurantQuery = {}) { restaurantsKey", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["isValidBaseUrl", "getApiBase", "getFlags", "importMock", "fetch", "JSON.parse", "new URL", "setTimeout"], "search-terms": ["API service", "food categories", "menu items", "order creation", "restaurant list", "mock data fallback", "environment variables", "cache management"], "state": 2, "file_id": 19, "knowledge_revision": 85, "git_revision": "410e1f03e40348cb83039a8db9b0f1f0046cad67", "revision_history": [{"41": ""}, {"49": "fa51b25a5136c2a213cbe729e4337be0c6b04b4d"}, {"50": "fa51b25a5136c2a213cbe729e4337be0c6b04b4d"}, {"53": "080dcebf5014d88192e81b4b55bca22f8703ca31"}, {"54": "080dcebf5014d88192e81b4b55bca22f8703ca31"}, {"57": "35883df6824081e2e752a88ef30ca7139d55531b"}, {"59": "2779e9974b574824b22ec1ba11b571a788f48888"}, {"60": "2779e9974b574824b22ec1ba11b571a788f48888"}, {"61": "2779e9974b574824b22ec1ba11b571a788f48888"}, {"72": "7d8d49548b0644d9213c7461f95715f9a2629b00"}, {"73": "7d8d49548b0644d9213c7461f95715f9a2629b00"}, {"85": "410e1f03e40348cb83039a8db9b0f1f0046cad67"}], "ctags": [{"_type": "tag", "name": "applyClientSide", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const applyClientSide = (list: Restaurant[]): Restaurant[] => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "createOrder", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "shouldUseMock", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const base = import.meta.env.VITE_API_BASE || import.meta.env.VITE_BACKEND_URL$/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "baseUrl", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const baseUrl = restaurantId$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "cache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^const cache = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.categoriesByRestaurant.get(restaurantId)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.itemByKey.get(key)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.itemsByKey.get(key)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.restaurantsByQuery.get(key)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "createOrder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function createOrder(payload: OrderPayload): Promise<OrderResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "featureFlags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export const featureFlags = flags$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fetchCategories", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchCategories(restaurantId?: string): Promise<FoodCategory[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchItemById", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchItemById(itemId: string, restaurantId?: string): Promise<FoodItem | n/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchItems", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchItems($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchRestaurants", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchRestaurants(query: RestaurantQuery = {}): Promise<Restaurant[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "flags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const forced = typeof flags.enableMockAPI === 'boolean' ? flags.enableMockAPI : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "shouldUseMock", "scopeKind": "function"}, {"_type": "tag", "name": "flags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^const flags = getFlags()$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "flagsRaw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const flagsRaw = import.meta.env.VITE_FEATURE_FLAGS$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}, {"_type": "tag", "name": "forced", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const forced = typeof flags.enableMockAPI === 'boolean' ? flags.enableMockAPI : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "shouldUseMock", "scopeKind": "function"}, {"_type": "tag", "name": "getApiBase", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export function getApiBase(): string | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getFlags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function getFlags(): Record<string, boolean> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "if", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      if (!res.ok) throw new Error('Failed to fetch categories')$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "importMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^async function importMock() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isValidBaseUrl", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function isValidBaseUrl(v: unknown): v is string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "itemsKey", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function itemsKey(params: { categoryId?: string; search?: string; restaurantId?: string }) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "k", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^        const [k, v] = kv.split('=')$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const key = `${restaurantId || ''}::${itemId}`$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const key = itemsKey({ categoryId, search, restaurantId })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const key = restaurantsKey(query)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "mockOrderSuccess", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^async function mockOrderSuccess(): Promise<OrderResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "obj", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^    const obj: Record<string, boolean> = {}$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, { headers: { 'Content-Type': 'application\\/json' } })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, { headers: { 'Content-Type': 'application\\/json' } })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, { headers: { 'Content-Type': 'application\\/json' } })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^    const res = await fetch(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/orders`, {$/", "language": "TypeScript", "kind": "constant", "scope": "createOrder", "scopeKind": "function"}, {"_type": "tag", "name": "restaurantsKey", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function restaurantsKey(query: RestaurantQuery = {}) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "serverList", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const serverList: Restaurant[] = await res.json()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "shouldUseMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function shouldUseMock(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "submitOrder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function submitOrder(payload: OrderPayload): Promise<OrderResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = new URL(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/restaurants`, window.locatio/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = new URL(baseUrl, window.location.origin)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = restaurantId$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = restaurantId$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^        const [k, v] = kv.split('=')$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}], "hash": "197309b23b8ec0eb8c11a9a272dee8f6", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/api.ts"}