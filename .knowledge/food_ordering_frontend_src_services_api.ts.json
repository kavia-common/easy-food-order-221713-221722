{"is_source_file": true, "format": "TypeScript", "description": "This file defines a set of services for fetching food-related data, such as categories, items, and restaurants, from a backend API or fallback mock data. It includes utility functions for URL validation, caching, and feature flags, as well as functions to create and submit orders.", "external_files": ["@/types", "@/services/mockData"], "external_methods": ["import('@/services/mockData')", "fetch"], "published": ["fetchCategories", "fetchItems", "fetchItemById", "createOrder", "submitOrder", "fetchRestaurants", "featureFlags"], "classes": [], "methods": [{"name": "function isValidBaseUrl(v: unknown): v is string { isValidBaseUrl", "description": "Validates whether a given value is a valid URL string or relative path.", "scope": "", "scopeKind": ""}, {"name": "export function getApiBase(): string | undefined { getApiBase", "description": "Retrieves the API base URL from environment variables if valid.", "scope": "", "scopeKind": ""}, {"name": "function getFlags(): Record<string, boolean> { getFlags", "description": "Parses feature flags from environment variables, supporting JSON and CSV formats.", "scope": "", "scopeKind": ""}, {"name": "function shouldUseMock(): boolean { shouldUseMock", "description": "Decides whether to use mock data based on feature flags and API base URL.", "scope": "", "scopeKind": ""}, {"name": "async function importMock() { importMock", "description": "Dynamically imports mock data module.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchCategories(restaurantId?: string): Promise<FoodCategory[]> { fetchCategories", "description": "Fetches food categories, optionally scoped to a restaurant, with caching and fallback to mock data.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchItems( fetchItems", "description": "Fetches food items with optional filters, caches results, and falls back to mock data on failure.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchItemById(itemId: string, restaurantId?: string): Promise<FoodItem | n/ fetchItemById", "description": "Fetches a specific food item by ID, with optional restaurant scope, caching, and fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function createOrder(payload: OrderPayload): Promise<OrderResponse> { createOrder", "description": "Creates a food order by POST request or falls back to mock response.", "scope": "", "scopeKind": ""}, {"name": "export async function submitOrder(payload: OrderPayload): Promise<OrderResponse> { submitOrder", "description": "Backward-compatible wrapper delegating to createOrder.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchRestaurants(query: RestaurantQuery = {}): Promise<Restaurant[]> { fetchRestaurants", "description": "Fetches restaurant list with filtering and sorting, with caching and fallback.", "scope": "", "scopeKind": ""}, {"name": "async function mockOrderSuccess(): Promise<OrderResponse> { mockOrderSuccess", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function restaurantsKey(query: RestaurantQuery = {}) { restaurantsKey", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["import('@/services/mockData')", "fetch", "new URL()", "JSON.parse", "setTimeout", "Math.random", "window.location.origin"], "search-terms": ["API fetch functions", "mockData fallback", "FoodCategory", "FoodItem", "OrderPayload", "RestaurantQuery", "environment variables", "feature flags", "caching"], "state": 2, "file_id": 19, "knowledge_revision": 73, "git_revision": "7d8d49548b0644d9213c7461f95715f9a2629b00", "revision_history": [{"41": ""}, {"49": "fa51b25a5136c2a213cbe729e4337be0c6b04b4d"}, {"50": "fa51b25a5136c2a213cbe729e4337be0c6b04b4d"}, {"53": "080dcebf5014d88192e81b4b55bca22f8703ca31"}, {"54": "080dcebf5014d88192e81b4b55bca22f8703ca31"}, {"57": "35883df6824081e2e752a88ef30ca7139d55531b"}, {"59": "2779e9974b574824b22ec1ba11b571a788f48888"}, {"60": "2779e9974b574824b22ec1ba11b571a788f48888"}, {"61": "2779e9974b574824b22ec1ba11b571a788f48888"}, {"72": "7d8d49548b0644d9213c7461f95715f9a2629b00"}, {"73": "7d8d49548b0644d9213c7461f95715f9a2629b00"}], "ctags": [{"_type": "tag", "name": "applyClientSide", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const applyClientSide = (list: Restaurant[]): Restaurant[] => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "createOrder", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const base = getApiBase()$/", "language": "TypeScript", "kind": "constant", "scope": "shouldUseMock", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const base = import.meta.env.VITE_API_BASE || import.meta.env.VITE_BACKEND_URL$/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "baseUrl", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const baseUrl = restaurantId$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "cache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^const cache = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.categoriesByRestaurant.get(restaurantId)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.itemByKey.get(key)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.itemsByKey.get(key)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const cached = cache.restaurantsByQuery.get(key)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "createOrder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function createOrder(payload: OrderPayload): Promise<OrderResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const data = await importMock()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "featureFlags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export const featureFlags = flags$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fetchCategories", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchCategories(restaurantId?: string): Promise<FoodCategory[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchItemById", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchItemById(itemId: string, restaurantId?: string): Promise<FoodItem | n/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchItems", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchItems($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchRestaurants", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function fetchRestaurants(query: RestaurantQuery = {}): Promise<Restaurant[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "flags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const forced = typeof flags.enableMockAPI === 'boolean' ? flags.enableMockAPI : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "shouldUseMock", "scopeKind": "function"}, {"_type": "tag", "name": "flags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^const flags = getFlags()$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "flagsRaw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const flagsRaw = import.meta.env.VITE_FEATURE_FLAGS$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}, {"_type": "tag", "name": "forced", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const forced = typeof flags.enableMockAPI === 'boolean' ? flags.enableMockAPI : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "shouldUseMock", "scopeKind": "function"}, {"_type": "tag", "name": "getApiBase", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export function getApiBase(): string | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getFlags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function getFlags(): Record<string, boolean> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "if", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      if (!res.ok) throw new Error('Failed to fetch categories')$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "importMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^async function importMock() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isValidBaseUrl", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function isValidBaseUrl(v: unknown): v is string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "itemsKey", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function itemsKey(params: { categoryId?: string; search?: string; restaurantId?: string }) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "k", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^        const [k, v] = kv.split('=')$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const key = `${restaurantId || ''}::${itemId}`$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const key = itemsKey({ categoryId, search, restaurantId })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const key = restaurantsKey(query)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "mockOrderSuccess", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^async function mockOrderSuccess(): Promise<OrderResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "obj", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^    const obj: Record<string, boolean> = {}$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^  const p = (async () => {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, { headers: { 'Content-Type': 'application\\/json' } })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, { headers: { 'Content-Type': 'application\\/json' } })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, { headers: { 'Content-Type': 'application\\/json' } })$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^    const res = await fetch(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/orders`, {$/", "language": "TypeScript", "kind": "constant", "scope": "createOrder", "scopeKind": "function"}, {"_type": "tag", "name": "restaurantsKey", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function restaurantsKey(query: RestaurantQuery = {}) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "serverList", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const serverList: Restaurant[] = await res.json()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "shouldUseMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^function shouldUseMock(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "submitOrder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^export async function submitOrder(payload: OrderPayload): Promise<OrderResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = new URL(`${String(base).replace(\\/\\\\\\/*$\\/, '')}\\/restaurants`, window.locatio/", "language": "TypeScript", "kind": "constant", "scope": "fetchRestaurants", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = new URL(baseUrl, window.location.origin)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItems", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = restaurantId$/", "language": "TypeScript", "kind": "constant", "scope": "fetchCategories", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^      const url = restaurantId$/", "language": "TypeScript", "kind": "constant", "scope": "fetchItemById", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/api.ts", "pattern": "/^        const [k, v] = kv.split('=')$/", "language": "TypeScript", "kind": "constant", "scope": "getFlags", "scopeKind": "function"}], "hash": "e5ecf7dbfdb6cbf2fe3e6ffb1999609c", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/api.ts"}