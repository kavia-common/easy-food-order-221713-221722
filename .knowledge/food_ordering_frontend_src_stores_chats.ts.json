{"is_source_file": true, "format": "TypeScript", "description": "This file defines a Pinia store for managing chat threads, messages, and user interactions in a Vue.js application. It includes reactive state, computed properties, and functions to load, open, send messages, subscribe to updates, and persist state locally.", "external_files": ["@/types/chat", "@/services/chatApi"], "external_methods": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "published": ["useChatsStore"], "classes": [], "methods": [{"name": "loadThreads", "description": "Loads chat threads from API, sorts them by update time, and persists state."}, {"name": "openThread", "description": "Creates or opens a chat thread, fetches messages if needed, and subscribes to updates."}, {"name": "async function send(content: string) { send", "description": "Sends a message in the current thread, updates message list and thread metadata.", "scope": "", "scopeKind": ""}, {"name": "function markRead(threadId: string) { markRead", "description": "Marks a thread as read, resetting its unread count.", "scope": "", "scopeKind": ""}, {"name": "function subscribe(threadId: string) { subscribe", "description": "Subscribes to real-time updates for a thread, handling new messages, typing indicators, and presence.", "scope": "", "scopeKind": ""}, {"name": "function selectThread(threadId: string) { selectThread", "description": "Sets the current thread by ID, subscribes if needed, marks thread as read.", "scope": "", "scopeKind": ""}, {"name": "function persistDebounced(state: unknown) { persistDebounced", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "search-terms": ["pinia store", "chatThreads", "websocket subscription", "persistDebounced", "localStorage chat state"], "state": 2, "file_id": 42, "knowledge_revision": 162, "git_revision": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620", "revision_history": [{"138": ""}, {"162": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620"}], "ctags": [{"_type": "tag", "name": "PERSIST_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^const PERSIST_KEY = 'chat_store_state_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "SubscriptionMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^interface SubscriptionMap {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "handle", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const handle = subscribeToThread(threadId, (ev: { type: 'message'|'typing'|'presence'; messa/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "markRead", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  function markRead(threadId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const msg = await sendMessage(currentThreadId.value, { content });$/", "language": "TypeScript", "kind": "constant", "scope": "send", "scopeKind": "function"}, {"_type": "tag", "name": "persistDebounced", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^function persistDebounced(state: unknown) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "selectThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  function selectThread(threadId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "self", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  const self = persistDebounced as unknown as { _t?: ReturnType<typeof setTimeout> }$/", "language": "TypeScript", "kind": "constant", "scope": "persistDebounced", "scopeKind": "function"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  async function send(content: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "subscribe", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  function subscribe(threadId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const t = threads.value.find((x) => x.id === currentThreadId.value);$/", "language": "TypeScript", "kind": "constant", "scope": "send", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const t = threads.value.find((x) => x.id === threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "markRead", "scopeKind": "function"}, {"_type": "tag", "name": "useChatsStore", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^export const useChatsStore = defineStore('chats', () => {$/", "language": "TypeScript", "kind": "constant"}], "hash": "c6e7f5bb62a8da543d287ae5b34b50e9", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/stores/chats.ts", "fields": [{"name": "interface SubscriptionMap {", "scope": "", "scopeKind": "", "description": "unavailable"}]}