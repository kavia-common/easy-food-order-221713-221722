{"is_source_file": true, "format": "TypeScript", "description": "This file contains functions related to handling reviews and ratings in a food ordering front-end application. It manages listing reviews, submitting reviews, computing rating summaries, and persisting reviews in local storage.", "external_files": ["./runtimeConfig"], "external_methods": ["nanoid"], "published": ["listRestaurantReviews", "listDeliveryReviews", "getRestaurantRatingSummary", "getDeliveryRatingSummary", "submitRestaurantReview", "submitDeliveryReview"], "classes": [], "methods": [{"name": "export function listRestaurantReviews( listRestaurantReviews", "description": "Retrieves a paginated list of reviews for a specific restaurant, sorted by creation date descending.", "scope": "", "scopeKind": ""}, {"name": "export function listDeliveryReviews( listDeliveryReviews", "description": "Retrieves a paginated list of reviews for a specific delivery person, sorted by creation date descending.", "scope": "", "scopeKind": ""}, {"name": "export function getRestaurantRatingSummary(restaurantId: string): RatingSummary { getRestaurantRatingSummary", "description": "Calculates a summary (average, distribution) of reviews for a specific restaurant.", "scope": "", "scopeKind": ""}, {"name": "export function getDeliveryRatingSummary(deliveryPersonId: string): RatingSummary { getDeliveryRatingSummary", "description": "Calculates a summary (average, distribution) of reviews for a specific delivery person.", "scope": "", "scopeKind": ""}, {"name": "export async function submitRestaurantReview( submitRestaurantReview", "description": "Submits a new review for a restaurant, performs validation, updates cache and local storage, and returns the outcome.", "scope": "", "scopeKind": ""}, {"name": "export async function submitDeliveryReview( submitDeliveryReview", "description": "Submits a new review for a delivery person, performs validation, updates cache and local storage, and returns the outcome.", "scope": "", "scopeKind": ""}, {"name": "function clampStars(n: number): 1 | 2 | 3 | 4 | 5 { clampStars", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function computeSummary(list: Review[]): RatingSummary { computeSummary", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function ensureLoaded() { ensureLoaded", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function isValidReviewShape(obj: any): obj is Review { isValidReviewShape", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function persist() { persist", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["localStorage.getItem", "localStorage.setItem", "JSON.parse", "JSON.stringify", "runtimeConfig"], "search-terms": ["ratings", "reviews", "localStorage", "ReviewCache", "submitReview", "computeSummary"], "state": 2, "file_id": 58, "knowledge_revision": 259, "git_revision": "", "ctags": [{"_type": "tag", "name": "LS_REVIEWS_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^const LS_REVIEWS_KEY = 'app.ratings.reviews.v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const all = reviewCache.filter($/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const all = reviewCache.filter($/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "average", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const average = Math.round((sum \\/ list.length) * 10) \\/ 10;$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "cacheLoaded", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^let cacheLoaded = false;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "clampStars", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^function clampStars(n: number): 1 | 2 | 3 | 4 | 5 {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "computeSummary", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^function computeSummary(list: Review[]): RatingSummary {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const data = all.slice(start, start + pageSize);$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const data = all.slice(start, start + pageSize);$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "distribution", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const distribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 } as RatingSummary['distribution'];$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "ensureLoaded", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^function ensureLoaded() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "exists", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^    const exists = reviewCache.find($/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "exists", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^    const exists = reviewCache.find($/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "getDeliveryRatingSummary", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^export function getDeliveryRatingSummary(deliveryPersonId: string): RatingSummary {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getRestaurantRatingSummary", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^export function getRestaurantRatingSummary(restaurantId: string): RatingSummary {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isValidReviewShape", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^function isValidReviewShape(obj: any): obj is Review {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "listDeliveryReviews", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^export function listDeliveryReviews($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "listRestaurantReviews", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^export function listRestaurantReviews($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "newReview", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const newReview: DeliveryRating = {$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "newReview", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const newReview: RestaurantRating = {$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const now = new Date().toISOString();$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const now = new Date().toISOString();$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "page", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const page = params.page && params.page > 0 ? params.page : 1;$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "page", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const page = params.page && params.page > 0 ? params.page : 1;$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "pageSize", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const pageSize = params.pageSize && params.pageSize > 0 ? params.pageSize : 10;$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "pageSize", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const pageSize = params.pageSize && params.pageSize > 0 ? params.pageSize : 10;$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "params", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const page = params.page && params.page > 0 ? params.page : 1;$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "params", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const page = params.page && params.page > 0 ? params.page : 1;$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "params", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const pageSize = params.pageSize && params.pageSize > 0 ? params.pageSize : 10;$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "params", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const pageSize = params.pageSize && params.pageSize > 0 ? params.pageSize : 10;$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^      const parsed = JSON.parse(raw) as Review[];$/", "language": "TypeScript", "kind": "constant", "scope": "ensureLoaded", "scopeKind": "function"}, {"_type": "tag", "name": "persist", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^function persist() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "r", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  for (const r of list) {$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "ratings", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const ratings = reviewCache.filter($/", "language": "TypeScript", "kind": "constant", "scope": "getDeliveryRatingSummary", "scopeKind": "function"}, {"_type": "tag", "name": "ratings", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const ratings = reviewCache.filter($/", "language": "TypeScript", "kind": "constant", "scope": "getRestaurantRatingSummary", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^    const raw = localStorage.getItem(LS_REVIEWS_KEY);$/", "language": "TypeScript", "kind": "constant", "scope": "ensureLoaded", "scopeKind": "function"}, {"_type": "tag", "name": "reviewCache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^let reviewCache: Review[] = [];$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "s", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^    const s = clampStars(r.stars);$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const start = (page - 1) * pageSize;$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const start = (page - 1) * pageSize;$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "submitDeliveryReview", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^export async function submitDeliveryReview($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "submitRestaurantReview", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^export async function submitRestaurantReview($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "summary", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const summary = getDeliveryRatingSummary(input.deliveryPersonId);$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "summary", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const summary = getRestaurantRatingSummary(input.restaurantId);$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const total = all.length;$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const total = all.length;$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "totalPages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const totalPages = Math.max(1, Math.ceil(total \\/ pageSize));$/", "language": "TypeScript", "kind": "constant", "scope": "listDeliveryReviews", "scopeKind": "function"}, {"_type": "tag", "name": "totalPages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const totalPages = Math.max(1, Math.ceil(total \\/ pageSize));$/", "language": "TypeScript", "kind": "constant", "scope": "listRestaurantReviews", "scopeKind": "function"}, {"_type": "tag", "name": "trimmed", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const trimmed = (comment ?? '').trim();$/", "language": "TypeScript", "kind": "constant", "scope": "computeSummary", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const v = Math.max(1, Math.min(5, Math.round(n)));$/", "language": "TypeScript", "kind": "constant", "scope": "clampStars", "scopeKind": "function"}, {"_type": "tag", "name": "validation", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const validation = validateInput(input.stars, input.comment);$/", "language": "TypeScript", "kind": "constant", "scope": "submitDeliveryReview", "scopeKind": "function"}, {"_type": "tag", "name": "validation", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/ratings.ts", "pattern": "/^  const validation = validateInput(input.stars, input.comment);$/", "language": "TypeScript", "kind": "constant", "scope": "submitRestaurantReview", "scopeKind": "function"}], "hash": "7f42e5fcc3265080273a11f605655800", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/ratings.ts", "fields": [{"name": "let cacheLoaded = false;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let reviewCache: Review[] = [];", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"259": ""}]}