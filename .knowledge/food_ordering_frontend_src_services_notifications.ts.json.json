{"is_source_file": true, "format": "TypeScript", "description": "This file implements a client-side notifications service for a web application, handling feature detection, user permissions, local storage preferences, service worker registration, and mock notifications for festival offers. It centralizes the logic for managing push notification capabilities, user consent, and feature toggles.", "external_files": ["/sw.js"], "external_methods": ["Notification.requestPermission", "navigator.serviceWorker.register", "navigator.serviceWorker.getRegistration", "PushManager", "localStorage.getItem", "localStorage.setItem", "localStorage.removeItem"], "published": ["isNotificationsFeatureEnabled", "isPushSupported", "getCapabilityState", "getNotificationPermission", "getFestivalOffersPreference", "setFestivalOffersPreference", "ensureServiceWorkerRegistered", "requestFestivalOffersPermission", "unsubscribeFestivalOffers", "getCapabilityHelpText", "canToggleForState", "isMockMode", "triggerMockFestivalOffer", "getNotificationsUIState"], "classes": [], "methods": [{"name": "function parseFeatureFlags(input?: string): Record<string, boolean> { parseFeatureFlags", "description": "Parses feature flags provided as a string, supporting JSON object format or comma-separated list.", "scope": "", "scopeKind": ""}, {"name": "async function sendSubscriptionToBackendPlaceholder(unsubscribe = false): Promise<void> { sendSubscriptionToBackendPlaceholder", "description": "Simulates sending subscription data to backend; currently a placeholder with no real network call.", "scope": "", "scopeKind": ""}, {"name": "export function canToggleForState(state: NotificationCapabilityState): boolean { canToggleForState", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export async function ensureServiceWorkerRegistered(): Promise<ServiceWorkerRegistration | null>/ ensureServiceWorkerRegistered", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function getCapabilityHelpText(state: NotificationCapabilityState): string { getCapabilityHelpText", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function getCapabilityState(): NotificationCapabilityState { getCapabilityState", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function getFestivalOffersPreference(): boolean { getFestivalOffersPreference", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function getNotificationPermission(): NotificationPermission { getNotificationPermission", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function getNotificationsUIState(): { getNotificationsUIState", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function isMockMode(): boolean { isMockMode", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function isNotificationsFeatureEnabled(): boolean { isNotificationsFeatureEnabled", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function isPushSupported(): boolean { isPushSupported", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export async function requestFestivalOffersPermission(): Promise<NotificationCapabilityState> { requestFestivalOffersPermission", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function setFestivalOffersPreference(value: boolean): void { setFestivalOffersPreference", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export function triggerMockFestivalOffer(cb?: (message: string) => void): void { triggerMockFestivalOffer", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export async function unsubscribeFestivalOffers(): Promise<void> { unsubscribeFestivalOffers", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["JSON.parse", "Notification.requestPermission", "navigator.serviceWorker.register", "navigator.serviceWorker.getRegistration", "localStorage.getItem", "localStorage.setItem", "localStorage.removeItem"], "search-terms": ["notifications", "ServiceWorker", "push", "permission", "festivalOffers", "mockNotification", "featureFlags"], "state": 2, "file_id": 51, "knowledge_revision": 229, "git_revision": "", "ctags": [{"_type": "tag", "name": "API_BASE", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const API_BASE =$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "DEV_MODE", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const DEV_MODE = !!(nodeEnv ? nodeEnv.includes('dev') : import.meta.env.DEV);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "DEV_MODE", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const NOTIFICATIONS_FEATURE_ENABLED = FLAGS.notifications ?? DEV_MODE;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "FLAGS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const FLAGS = parseFeatureFlags(rawFlags);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "FRONTEND_URL", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const FRONTEND_URL = import.meta.env.VITE_FRONTEND_URL as string | undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "LS_KEYS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const LS_KEYS = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "NOTIFICATIONS_FEATURE_ENABLED", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const NOTIFICATIONS_FEATURE_ENABLED = FLAGS.notifications ?? DEV_MODE;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "NotificationCapabilityState", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export type NotificationCapabilityState = 'not_supported' | 'blocked' | 'prompt' | 'granted';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "asObj", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^    const asObj = JSON.parse(input);$/", "language": "TypeScript", "kind": "constant", "scope": "parseFeatureFlags", "scopeKind": "function"}, {"_type": "tag", "name": "cachedCapability", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^let cachedCapability: NotificationCapabilityState | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "cachedPermission", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^let cachedPermission: NotificationPermission | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "canToggleForState", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function canToggleForState(state: NotificationCapabilityState): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const current = getNotificationPermission();$/", "language": "TypeScript", "kind": "constant", "scope": "requestFestivalOffersPermission", "scopeKind": "function"}, {"_type": "tag", "name": "enabled", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const enabled = isNotificationsFeatureEnabled();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ensureServiceWorkerRegistered", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export async function ensureServiceWorkerRegistered(): Promise<ServiceWorkerRegistration | null>/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getCapabilityHelpText", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function getCapabilityHelpText(state: NotificationCapabilityState): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getCapabilityState", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function getCapabilityState(): NotificationCapabilityState {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getFestivalOffersPreference", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function getFestivalOffersPreference(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getNotificationPermission", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function getNotificationPermission(): NotificationPermission {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getNotificationsUIState", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function getNotificationsUIState(): {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "hasNotification", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const hasNotification = typeof window !== 'undefined' && 'Notification' in window;$/", "language": "TypeScript", "kind": "constant", "scope": "isPushSupported", "scopeKind": "function"}, {"_type": "tag", "name": "hasPush", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const hasPush = typeof window !== 'undefined' && 'PushManager' in window;$/", "language": "TypeScript", "kind": "constant", "scope": "isPushSupported", "scopeKind": "function"}, {"_type": "tag", "name": "hasSW", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const hasSW = typeof navigator !== 'undefined' && 'serviceWorker' in navigator;$/", "language": "TypeScript", "kind": "constant", "scope": "isPushSupported", "scopeKind": "function"}, {"_type": "tag", "name": "isMockMode", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function isMockMode(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isNotificationsFeatureEnabled", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function isNotificationsFeatureEnabled(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isPushSupported", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function isPushSupported(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const message = 'Special Festival Offer: Get 20% off on your next order!';$/", "language": "TypeScript", "kind": "constant", "scope": "triggerMockFestivalOffer", "scopeKind": "function"}, {"_type": "tag", "name": "nodeEnv", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const nodeEnv = import.meta.env.VITE_NODE_ENV as string | undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "out", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const out: Record<string, boolean> = {};$/", "language": "TypeScript", "kind": "constant", "scope": "parseFeatureFlags", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const p = getNotificationPermission();$/", "language": "TypeScript", "kind": "constant", "scope": "getCapabilityState", "scopeKind": "function"}, {"_type": "tag", "name": "parseFeatureFlags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^function parseFeatureFlags(input?: string): Record<string, boolean> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "rawFlags", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^const rawFlags = import.meta.env.VITE_FEATURE_FLAGS as string | undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "reg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^      const reg = await ensureServiceWorkerRegistered();$/", "language": "TypeScript", "kind": "constant", "scope": "requestFestivalOffersPermission", "scopeKind": "function"}, {"_type": "tag", "name": "reg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^    const reg = (await navigator.serviceWorker?.getRegistration?.()) ?? null;$/", "language": "TypeScript", "kind": "constant", "scope": "unsubscribeFestivalOffers", "scopeKind": "function"}, {"_type": "tag", "name": "reg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^    const reg = await navigator.serviceWorker.register('\\/sw.js');$/", "language": "TypeScript", "kind": "constant", "scope": "ensureServiceWorkerRegistered", "scopeKind": "function"}, {"_type": "tag", "name": "requestFestivalOffersPermission", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export async function requestFestivalOffersPermission(): Promise<NotificationCapabilityState> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^    const result = await Notification.requestPermission();$/", "language": "TypeScript", "kind": "constant", "scope": "requestFestivalOffersPermission", "scopeKind": "function"}, {"_type": "tag", "name": "sendSubscriptionToBackendPlaceholder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^async function sendSubscriptionToBackendPlaceholder(unsubscribe = false): Promise<void> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "setFestivalOffersPreference", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function setFestivalOffersPreference(value: boolean): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "st", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const st = getCapabilityState();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^  const state = getCapabilityState();$/", "language": "TypeScript", "kind": "constant", "scope": "isMockMode", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^        const sub = await reg.pushManager.getSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "unsubscribeFestivalOffers", "scopeKind": "function"}, {"_type": "tag", "name": "subscriptionCached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^let subscriptionCached = false;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "triggerMockFestivalOffer", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export function triggerMockFestivalOffer(cb?: (message: string) => void): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "unsubscribeFestivalOffers", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^export async function unsubscribeFestivalOffers(): Promise<void> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/notifications.ts", "pattern": "/^    const v = localStorage.getItem(LS_KEYS.festivalOffersOptIn);$/", "language": "TypeScript", "kind": "constant", "scope": "getFestivalOffersPreference", "scopeKind": "function"}], "hash": "cdcf070f20f8da494e2521b2456dae51", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/notifications.ts", "fields": [{"name": "let cachedCapability: NotificationCapabilityState | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let cachedPermission: NotificationPermission | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let subscriptionCached = false;", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"229": ""}]}