{"is_source_file": true, "format": "TypeScript (Vue 3 + Pinia store)", "description": "This file defines a Pinia store for managing chat threads, messages, and related state in a Vue 3 application. It includes functions for loading threads, opening threads, sending messages, subscribing to real-time updates, and persisting state locally.", "external_files": ["@/types/chat", "@/services/chatApi"], "external_methods": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "published": ["useChatsStore"], "classes": [], "methods": [{"name": "function persistDebounced(state: unknown) { persistDebounced", "description": "Debounced function to persist the store state to localStorage after a delay.", "scope": "", "scopeKind": ""}, {"name": "loadThreads", "description": "Fetches and sorts chat threads, updating the store state."}, {"name": "openThread", "description": "Creates or retrieves a chat thread, loads messages if necessary, and subscribes to real-time updates."}, {"name": "async function send(content: string) { send", "description": "Sends a message in the current thread, appends it to state, and updates the thread's latestMessage.", "scope": "", "scopeKind": ""}, {"name": "function markRead(threadId: string) { markRead", "description": "Marks a thread as read by resetting its unread count.", "scope": "", "scopeKind": ""}, {"name": "function subscribe(threadId: string) { subscribe", "description": "Subscribes to real-time updates for a specific thread, handling incoming messages, typing indicators, and presence.", "scope": "", "scopeKind": ""}, {"name": "function selectThread(threadId: string) { selectThread", "description": "Selects a thread as the current thread, initiates subscription, and marks it as read.", "scope": "", "scopeKind": ""}], "calls": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "search-terms": ["pinia store", "chat thread management", "Vue 3", "chat API", "local storage persistence", "thread subscription", "messages handling"], "state": 2, "file_id": 42, "knowledge_revision": 193, "git_revision": "ef85c21ea4ed8dfbec99666038bc8f94558191b0", "revision_history": [{"138": ""}, {"162": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620"}, {"193": "ef85c21ea4ed8dfbec99666038bc8f94558191b0"}], "ctags": [{"_type": "tag", "name": "PERSIST_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^const PERSIST_KEY = 'chat_store_state_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "SubscriptionMap", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^interface SubscriptionMap {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "handle", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const handle = subscribeToThread(threadId, (ev: { type: 'message'|'typing'|'presence'; messa/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "markRead", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  function markRead(threadId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const msg = await sendMessage(currentThreadId.value, { content });$/", "language": "TypeScript", "kind": "constant", "scope": "send", "scopeKind": "function"}, {"_type": "tag", "name": "persistDebounced", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^function persistDebounced(state: unknown) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "selectThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  function selectThread(threadId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "self", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  const self = persistDebounced as unknown as { _t?: ReturnType<typeof setTimeout> }$/", "language": "TypeScript", "kind": "constant", "scope": "persistDebounced", "scopeKind": "function"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  async function send(content: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "subscribe", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^  function subscribe(threadId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const t = threads.value.find((x) => x.id === currentThreadId.value);$/", "language": "TypeScript", "kind": "constant", "scope": "send", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^    const t = threads.value.find((x) => x.id === threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "markRead", "scopeKind": "function"}, {"_type": "tag", "name": "useChatsStore", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/chats.ts", "pattern": "/^export const useChatsStore = defineStore('chats', () => {$/", "language": "TypeScript", "kind": "constant"}], "hash": "ebd82f52a8bf5b9ed8d820336df9e19c", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/stores/chats.ts", "fields": [{"name": "interface SubscriptionMap {", "scope": "", "scopeKind": "", "description": "unavailable"}]}