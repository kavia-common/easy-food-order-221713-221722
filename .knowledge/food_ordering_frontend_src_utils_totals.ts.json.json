{"is_source_file": true, "format": "TypeScript", "description": "This file defines a utility function `calculateTotals` for computing various cost components of a food order, including handling coupons, VIP discounts, meal credits, taxes, and delivery fees.", "external_files": ["@/services/couponsHelper", "@/stores/subscriptions"], "external_methods": ["applyBestCoupon"], "published": ["calculateTotals"], "classes": [], "methods": [{"name": "export function calculateTotals(input: TotalsInput): TotalsOutput { calculateTotals", "description": "Calculates the overall totals for an order based on line items, discounts, taxes, and delivery fees.", "scope": "", "scopeKind": ""}], "calls": ["applyBestCoupon", "useSubscriptionsStore().isActive", "useSubscriptionsStore().activeDiscountPercent", "useSubscriptionsStore().consumeMealCredits", "useSubscriptionsStore().mealPlanCreditsRemaining", "useSubscriptionsStore().hasFreeDelivery"], "search-terms": ["calculateTotals", "totals calculation", "coupons", "VIP discount", "meal credits", "delivery fee", "tax calculation"], "state": 2, "file_id": 38, "knowledge_revision": 126, "git_revision": "", "ctags": [{"_type": "tag", "name": "TotalsInput", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^export interface TotalsInput {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "TotalsOutput", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^export interface TotalsOutput {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "afterCoupon", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const afterCoupon = Math.max(0, subtotal - couponResult.discount);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "afterCredits", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const afterCredits = Math.max(0, afterVip - mealCreditsApplied);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "afterVip", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const afterVip = Math.max(0, afterCoupon - vipDiscount);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "applied", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^    const applied = subs.consumeMealCredits(afterVip);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "appliedCouponCode", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  appliedCouponCode?: string | null;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsInput", "scopeKind": "interface"}, {"_type": "tag", "name": "calculateTotals", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^export function calculateTotals(input: TotalsInput): TotalsOutput {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "couponDiscount", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  couponDiscount: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "couponResult", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const couponResult = applyBestCoupon(subtotal, input.appliedCouponCode || undefined);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "deliveryFee", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const deliveryFee = subs.hasFreeDelivery ? 0 : input.deliveryFee;$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "deliveryFee", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  deliveryFee: number; \\/\\/ cents$/", "language": "TypeScript", "kind": "property", "scope": "TotalsInput", "scopeKind": "interface"}, {"_type": "tag", "name": "deliveryFee", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  deliveryFee: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "lineItems", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  lineItems: Array<{ price: number; quantity: number }>; \\/\\/ cents$/", "language": "TypeScript", "kind": "property", "scope": "TotalsInput", "scopeKind": "interface"}, {"_type": "tag", "name": "mealCreditsApplied", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  mealCreditsApplied: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "subs", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const subs = useSubscriptionsStore();$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "subs", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const vipPercent = subs.isActive ? subs.activeDiscountPercent : 0;$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "subtotal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const subtotal = input.lineItems.reduce((acc, li) => acc + li.price * li.quantity, 0);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "subtotal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  subtotal: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "tax", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const tax = Math.round(afterCredits * input.taxRate);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "tax", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  tax: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "taxRate", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  taxRate: number; \\/\\/ fraction, e.g., 0.08$/", "language": "TypeScript", "kind": "property", "scope": "TotalsInput", "scopeKind": "interface"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const total = afterCredits + tax + deliveryFee;$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  total: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "vipDiscount", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const vipDiscount = Math.round((afterCoupon * vipPercent) \\/ 100);$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}, {"_type": "tag", "name": "vipDiscount", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  vipDiscount: number;$/", "language": "TypeScript", "kind": "property", "scope": "TotalsOutput", "scopeKind": "interface"}, {"_type": "tag", "name": "vipPercent", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/utils/totals.ts", "pattern": "/^  const vipPercent = subs.isActive ? subs.activeDiscountPercent : 0;$/", "language": "TypeScript", "kind": "constant", "scope": "calculateTotals", "scopeKind": "function"}], "hash": "23dd3351c4dd1a16991bdbaf3c4f4149", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/utils/totals.ts", "fields": [{"name": "export interface TotalsInput {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export interface TotalsOutput {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "appliedCouponCode?: string | null;", "scope": "TotalsInput", "scopeKind": "interface", "description": "unavailable"}, {"name": "couponDiscount: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}, {"name": "deliveryFee: number; \\/\\/ cents", "scope": "TotalsInput", "scopeKind": "interface", "description": "unavailable"}, {"name": "deliveryFee: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}, {"name": "lineItems: Array<{ price: number; quantity: number }>; \\/\\/ cents", "scope": "TotalsInput", "scopeKind": "interface", "description": "unavailable"}, {"name": "mealCreditsApplied: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}, {"name": "subtotal: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}, {"name": "tax: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}, {"name": "taxRate: number; \\/\\/ fraction, e.g., 0.08", "scope": "TotalsInput", "scopeKind": "interface", "description": "unavailable"}, {"name": "total: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}, {"name": "vipDiscount: number;", "scope": "TotalsOutput", "scopeKind": "interface", "description": "unavailable"}], "revision_history": [{"126": ""}]}