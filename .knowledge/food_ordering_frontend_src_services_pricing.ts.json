{"is_source_file": true, "format": "TypeScript", "description": "This file provides utility functions related to pricing calculations for a food ordering system, including subtotal calculation, discount application, tax computation, and delivery fee estimation based on time conditions like rush hours and weekends. It also exposes a main function to compute full totals for a cart.", "external_files": ["@/types", "@/services/coupons", "./pricingConfig"], "external_methods": ["Object.is"], "published": ["safeRound2", "lineSubtotal", "couponDiscount", "computeTax", "isWeekend", "parseRushHours", "isRushHour", "computeDeliveryFee", "computeTotals"], "classes": [], "methods": [{"name": "export function safeRound2(n: number): number { safeRound2", "description": "Rounds a number to two decimal places and ensures that -0 is converted to 0.", "scope": "", "scopeKind": ""}, {"name": "export function lineSubtotal(lines: CartLine[]): number { lineSubtotal", "description": "Calculates the sum of price multiplied by quantity for each line item in the cart.", "scope": "", "scopeKind": ""}, {"name": "export function couponDiscount(subtotal: number, coupon?: Coupon | null): number { couponDiscount", "description": "Calculates the discount amount based on subtotal and coupon details, supporting percentage or fixed discounts.", "scope": "", "scopeKind": ""}, {"name": "export function computeTax(taxable: number, taxRate: number): number { computeTax", "description": "Calculates tax based on taxable amount and tax rate.", "scope": "", "scopeKind": ""}, {"name": "export function isWeekend(date: Date): boolean { isWeekend", "description": "Determines if a date falls on a weekend (Saturday or Sunday).", "scope": "", "scopeKind": ""}, {"name": "export function parseRushHours(spec: string): Array<[number, number]> { parseRushHours", "description": "Parses rush hour string specifications into minute ranges.", "scope": "", "scopeKind": ""}, {"name": "export function isRushHour(date: Date, rushSpec: string): boolean { isRushHour", "description": "Checks if a given date and time falls within any specified rush hour ranges.", "scope": "", "scopeKind": ""}, {"name": "computeDeliveryFee", "description": "Calculates delivery fee based on date, cart contents, and delivery options including rush hours and weekend surcharges."}, {"name": "computeTotals", "description": "Calculates the subtotal, discount, tax, delivery fee, and total for a cart, based on provided input."}], "calls": ["Math.round", "lines.reduce", "Math.min", "Math.max", "Object.is", "isRushHour", "parseRushHours"], "search-terms": ["pricing utilities", "delivery fee calculation", "rush hour parser", "cart subtotal", "coupon discount"], "state": 2, "file_id": 53, "knowledge_revision": 246, "git_revision": "59eba850def3898853840af7e03ece5eabf7887a", "revision_history": [{"233": ""}, {"246": "59eba850def3898853840af7e03ece5eabf7887a"}], "ctags": [{"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const base = Math.max(0, options.baseFee || 0)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "computeTax", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function computeTax(taxable: number, taxRate: number): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "couponDiscount", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function couponDiscount(subtotal: number, coupon?: Coupon | null): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const d = date.getDay()$/", "language": "TypeScript", "kind": "constant", "scope": "isWeekend", "scopeKind": "function"}, {"_type": "tag", "name": "deliveryFee", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const deliveryFee = safeRound2(Math.max(0, input.deliveryFee ?? 0))$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "discount", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const discount = couponDiscount(subtotal, input.coupon)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "e", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  for (const [s, e] of ranges) {$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "eMin", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^    const eMin = toMin(end)$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "end", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^    const [start, end] = p.split('-').map(s => s.trim())$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "isRushHour", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function isRushHour(date: Date, rushSpec: string): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isWeekend", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function isWeekend(date: Date): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "lineSubtotal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function lineSubtotal(lines: CartLine[]): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "mins", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const mins = date.getHours() * 60 + date.getMinutes()$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  for (const p of parts) {$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "parseRushHours", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function parseRushHours(spec: string): Array<[number, number]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parts", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const parts = (spec || '').split(',').map(s => s.trim()).filter(Boolean)$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "r", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const r = Math.round(n * 100) \\/ 100$/", "language": "TypeScript", "kind": "constant", "scope": "safeRound2", "scopeKind": "function"}, {"_type": "tag", "name": "ranges", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const ranges = parseRushHours(rushSpec)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "ranges", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const ranges: Array<[number, number]> = []$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "s", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  for (const [s, e] of ranges) {$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "sMin", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^    const sMin = toMin(start)$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "safeRound2", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^export function safeRound2(n: number): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^    const [start, end] = p.split('-').map(s => s.trim())$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "subtotal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const subtotal = lineSubtotal(input.lines)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "tax", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const tax = computeTax(taxable, input.taxRate ?? 0)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "taxable", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const taxable = Math.max(0, subtotal - discount)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}, {"_type": "tag", "name": "toMin", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^    const toMin = (hhmm: string): number => {$/", "language": "TypeScript", "kind": "constant", "scope": "parseRushHours", "scopeKind": "function"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/pricing.ts", "pattern": "/^  const total = safeRound2(taxable + tax + deliveryFee)$/", "language": "TypeScript", "kind": "constant", "scope": "isRushHour", "scopeKind": "function"}], "hash": "1e64771f895490477b3ec35751e45f90", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/pricing.ts"}