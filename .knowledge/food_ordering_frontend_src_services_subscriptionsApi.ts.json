{"is_source_file": true, "format": "TypeScript", "description": "This file defines functions and constants for managing subscription plans, user subscriptions, local storage caching, and API interactions for a food ordering frontend. It includes mock data for plans, functions to load and persist data, and API wrappers with fallback logic.", "external_files": ["@/types/subscriptions"], "external_methods": ["fetch"], "published": ["listPlans", "getCurrentSubscription", "subscribe", "cancelSubscription", "getPerks"], "classes": [], "methods": [{"name": "export async function listPlans(): Promise<SubscriptionPlan[]> { listPlans", "description": "Returns available subscription plans, using cached data, API, or mock data as fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function getCurrentSubscription(): Promise<UserSubscription> { getCurrentSubscription", "description": "Fetches the current user subscription from API or local storage.", "scope": "", "scopeKind": ""}, {"name": "export async function subscribe(planId: string): Promise<UserSubscription> { subscribe", "description": "Subscribes the user to a specified plan, with API fallback to local mock persistence.", "scope": "", "scopeKind": ""}, {"name": "export async function cancelSubscription(): Promise<UserSubscription> { cancelSubscription", "description": "Cancels the current subscription, marking it canceled locally if API is unavailable.", "scope": "", "scopeKind": ""}, {"name": "export async function getPerks(): Promise<SubscriptionPerk[]> { getPerks", "description": "Retrieves perk details for the current user's subscription.", "scope": "", "scopeKind": ""}, {"name": "function defaultUserSubscription(): UserSubscription { defaultUserSubscription", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function fetchFromApi<T>(path: string): Promise<T> { fetchFromApi", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function hasFreshCache(): boolean { hasFreshCache", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function loadPlansFromStorage(): SubscriptionPlan[] | null { loadPlansFromStorage", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function loadUserSubFromStorage(): UserSubscription | null { loadUserSubFromStorage", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function mockPlans(): SubscriptionPlan[] { mockPlans", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function normalizeApiBase(v?: string): string | undefined { normalizeApiBase", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function now(): number { now", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function persistPlans(plans: SubscriptionPlan[]) { persistPlans", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function persistUserSub(sub: UserSubscription) { persistUserSub", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function safeGetItem(key: string): string | null { safeGetItem", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function safeSetItem(key: string, value: string) { safeSetItem", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetchFromApi", "loadPlansFromStorage", "loadUserSubFromStorage", "persistPlans", "persistUserSub", "safeGetItem", "safeSetItem"], "search-terms": ["subscriptionsApi", "localStorage", "mockPlans", "API fallback", "subscription plans", "user subscription"], "state": 2, "file_id": 36, "knowledge_revision": 191, "git_revision": "222638623460685c384db599cd7b795a0c3616d8", "revision_history": [{"122": ""}, {"191": "222638623460685c384db599cd7b795a0c3616d8"}], "ctags": [{"_type": "tag", "name": "CACHE_TTL_MS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^const CACHE_TTL_MS = 5 * 60 * 1000; \\/\\/ 5 minutes$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "STORAGE_KEYS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^const STORAGE_KEYS = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "SubscriptionPerk", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^import { SubscriptionPerkType, type SubscriptionPerk, type SubscriptionPlan, type UserSubscripti/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SubscriptionPlan", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^import { SubscriptionPerkType, type SubscriptionPerk, type SubscriptionPlan, type UserSubscripti/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "UserSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^import { SubscriptionPerkType, type SubscriptionPerk, type SubscriptionPlan, type UserSubscripti/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const base = normalizeApiBase(import.meta.env.VITE_API_BASE as string | undefined);$/", "language": "TypeScript", "kind": "constant", "scope": "fetchFromApi", "scopeKind": "function"}, {"_type": "tag", "name": "cached", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const cached = loadPlansFromStorage();$/", "language": "TypeScript", "kind": "constant", "scope": "listPlans", "scopeKind": "function"}, {"_type": "tag", "name": "cancelSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function cancelSubscription(): Promise<UserSubscription> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "canceled", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const canceled: UserSubscription = {$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const current = await getCurrentSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "def", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const def = defaultUserSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "getCurrentSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "defaultUserSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function defaultUserSubscription(): UserSubscription {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.FreeDelivery, description: 'Free delivery on all orders', value/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.FreeDelivery, description: 'Free delivery on eligible orders', /", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.MealPlan, description: 'Monthly meal plan credits', value: 2000/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    { type: SubscriptionPerkType.VipDiscount, description: 'VIP discount on every order', value:/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "fetchFromApi", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^async function fetchFromApi<T>(path: string): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getCurrentSubscription", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function getCurrentSubscription(): Promise<UserSubscription> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getPerks", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function getPerks(): Promise<SubscriptionPerk[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "hasFreshCache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function hasFreshCache(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "listPlans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function listPlans(): Promise<SubscriptionPlan[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "loadPlansFromStorage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function loadPlansFromStorage(): SubscriptionPlan[] | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "loadUserSubFromStorage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function loadUserSubFromStorage(): UserSubscription | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "local", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const local = loadUserSubFromStorage();$/", "language": "TypeScript", "kind": "constant", "scope": "getCurrentSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "mockPlans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function mockPlans(): SubscriptionPlan[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const n = parseInt(ts, 10);$/", "language": "TypeScript", "kind": "constant", "scope": "hasFreshCache", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeApiBase", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function normalizeApiBase(v?: string): string | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function now(): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "perksBasic", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const perksBasic: SubscriptionPerk[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "perksMeal", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const perksMeal: SubscriptionPerk[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "perksVip", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const perksVip: SubscriptionPerk[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "mockPlans", "scopeKind": "function"}, {"_type": "tag", "name": "persistPlans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function persistPlans(plans: SubscriptionPlan[]) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "persistUserSub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function persistUserSub(sub: UserSubscription) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "plan", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plan = plans.find(p => p.id === planId);$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "plans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plans = (await listPlans()) || [];$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "plans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plans = await fetchFromApi<SubscriptionPlan[]>('\\/subscriptions\\/plans');$/", "language": "TypeScript", "kind": "constant", "scope": "listPlans", "scopeKind": "function"}, {"_type": "tag", "name": "plans", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const plans = mockPlans();$/", "language": "TypeScript", "kind": "constant", "scope": "listPlans", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const raw = safeGetItem(STORAGE_KEYS.plans);$/", "language": "TypeScript", "kind": "constant", "scope": "loadPlansFromStorage", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const raw = safeGetItem(STORAGE_KEYS.userSub);$/", "language": "TypeScript", "kind": "constant", "scope": "loadUserSubFromStorage", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const res = await fetch(url, { credentials: 'include' });$/", "language": "TypeScript", "kind": "constant", "scope": "fetchFromApi", "scopeKind": "function"}, {"_type": "tag", "name": "safeGetItem", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function safeGetItem(key: string): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "safeSetItem", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^function safeSetItem(key: string, value: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^      status: 'active',$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^      status: current.planId ? 'canceled' : 'none',$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub = await fetchFromApi<UserSubscription>('\\/subscriptions\\/cancel');$/", "language": "TypeScript", "kind": "constant", "scope": "cancelSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub = await fetchFromApi<UserSubscription>('\\/subscriptions\\/current');$/", "language": "TypeScript", "kind": "constant", "scope": "getCurrentSubscription", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub = await fetchFromApi<UserSubscription>(`\\/subscriptions\\/subscribe?planId=${encode/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^    const sub: UserSubscription = {$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const sub = await getCurrentSubscription();$/", "language": "TypeScript", "kind": "constant", "scope": "getPerks", "scopeKind": "function"}, {"_type": "tag", "name": "subscribe", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^export async function subscribe(planId: string): Promise<UserSubscription> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ts", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const ts = safeGetItem(STORAGE_KEYS.cacheTs);$/", "language": "TypeScript", "kind": "constant", "scope": "hasFreshCache", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/subscriptionsApi.ts", "pattern": "/^  const url = `${base}${path}`;$/", "language": "TypeScript", "kind": "constant", "scope": "fetchFromApi", "scopeKind": "function"}], "hash": "b6a1dd7dd42b94d44323012081744cba", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/subscriptionsApi.ts"}