{"is_source_file": true, "format": "TypeScript", "description": "This file defines a Pinia store for managing reviews related to restaurants and delivery persons. It includes state definitions, actions to load and submit reviews, and handles optimistic updates with rollback for failures.", "external_files": ["@/services/ratingsApi", "@/types/reviews"], "external_methods": ["fetchDeliveryReviews", "fetchRestaurantReviews", "submitDeliveryReview", "submitRestaurantReview"], "published": ["useReviewsStore"], "classes": [], "methods": [{"name": "setLoading", "description": "Sets the loading state for a specific key."}, {"name": "setError", "description": "Sets the error message for a specific key."}, {"name": "loadRestaurantReviews", "description": "Loads and caches restaurant review summary and recent reviews."}, {"name": "submitRestaurantReviewOptimistic", "description": "Optimistically adds a restaurant review and rolls back on failure."}, {"name": "loadDeliveryReviewsByPerson", "description": "Loads delivery reviews for a person with summary and caches them."}, {"name": "loadDeliveryReviewByOrder", "description": "Loads the delivery review for a specific order."}, {"name": "submitDeliveryReviewOptimistic", "description": "Optimistically submits or updates a delivery review for an order, with rollback."}], "calls": ["fetchRestaurantReviews", "fetchDeliveryReviews", "submitRestaurantReview", "submitDeliveryReview"], "search-terms": ["Pinia store", "reviews", "loadReviews", "submitReview", "optimistic update", "restaurantReviews", "deliveryReviews"], "state": 2, "file_id": 31, "knowledge_revision": 98, "git_revision": "", "revision_history": [{"93": ""}, {"97": ""}, {"98": ""}], "ctags": [{"_type": "tag", "name": "EntityId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^type EntityId = string;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "Error", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^        const msg = e instanceof Error ? e.message : 'Failed to submit delivery review';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ReviewsState", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^interface ReviewsState {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "avg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^          const avg = Math.round((total \\/ count) * 10) \\/ 10;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^          const count = personSummaryPrev.count + 1;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "created", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^        const created = await submitDeliveryReview(payload);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "deliveryByOrder", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  deliveryByOrder: Record<EntityId, DeliveryReview | undefined>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "deliveryRecentByPerson", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  deliveryRecentByPerson: Record<EntityId, DeliveryReview[]>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "deliverySummariesByPerson", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  deliverySummariesByPerson: Record<EntityId, RatingSummary | undefined>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "e", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^        const msg = e instanceof Error ? e.message : 'Failed to submit delivery review';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  errors: Record<string, string | undefined>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "instanceof", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^        const msg = e instanceof Error ? e.message : 'Failed to submit delivery review';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "loading", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  loading: Record<string, boolean>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^        const msg = e instanceof Error ? e.message : 'Failed to submit delivery review';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "restaurantRecent", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  restaurantRecent: Record<EntityId, RestaurantReview[]>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "restaurantSummaries", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^  restaurantSummaries: Record<EntityId, RatingSummary | undefined>;$/", "language": "TypeScript", "kind": "property", "scope": "ReviewsState", "scopeKind": "interface"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^          const total = personSummaryPrev.average * personSummaryPrev.count + payload.rating;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "useReviewsStore", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/stores/reviews.ts", "pattern": "/^export const useReviewsStore = defineStore('reviews', {$/", "language": "TypeScript", "kind": "constant"}], "hash": "3f3d0bd77463059da05779b5f1745b45", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/stores/reviews.ts", "fields": [{"name": "interface ReviewsState {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "deliveryByOrder: Record<EntityId, DeliveryReview | undefined>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}, {"name": "deliveryRecentByPerson: Record<EntityId, DeliveryReview[]>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}, {"name": "deliverySummariesByPerson: Record<EntityId, RatingSummary | undefined>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}, {"name": "errors: Record<string, string | undefined>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}, {"name": "loading: Record<string, boolean>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}, {"name": "restaurantRecent: Record<EntityId, RestaurantReview[]>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}, {"name": "restaurantSummaries: Record<EntityId, RatingSummary | undefined>;", "scope": "ReviewsState", "scopeKind": "interface", "description": "unavailable"}]}