{"is_source_file": true, "format": "TypeScript", "description": "This file implements a Chat API service for a food ordering frontend. It provides methods to list, create, and fetch messages for chat threads, send messages, and subscribe to thread events. It includes backend communication via HTTP, as well as local storage and mock data fallback mechanisms for development or offline mode. It also handles WebSocket news updates with fallback to polling.", "external_files": ["@/types/chat", "./helpersRuntime"], "external_methods": ["nanoid", "isServer"], "published": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "classes": [], "methods": [{"name": "function normalizeBaseUrl(v?: string): string | undefined { normalizeBaseUrl", "description": "Ensures the given URL string is valid or provides undefined if invalid.", "scope": "", "scopeKind": ""}, {"name": "function getUserId(): string { getUserId", "description": "Retrieves a unique user ID, generating and storing one if necessary.", "scope": "", "scopeKind": ""}, {"name": "function readLS<T>(key: string, fallback: T): T { readLS", "description": "Reads a value from LocalStorage with fallback.", "scope": "", "scopeKind": ""}, {"name": "function writeLS<T>(key: string, value: T) { writeLS", "description": "Writes a value to LocalStorage.", "scope": "", "scopeKind": ""}, {"name": "function seedMockIfEmpty() { seedMockIfEmpty", "description": "Initializes mock chat data in local storage if none exists.", "scope": "", "scopeKind": ""}, {"name": "function loadAllMock(): { threads: ChatThread[]; messages: Record<string, ChatMessage[]> } { loadAllMock", "description": "Loads all mock threads and messages from local storage.", "scope": "", "scopeKind": ""}, {"name": "function saveMock( saveMock", "description": "Saves mock threads and messages to local storage.", "scope": "", "scopeKind": ""}, {"name": "function canUseWS(): boolean { canUseWS", "description": "Determines if WebSocket connections can be established.", "scope": "", "scopeKind": ""}, {"name": "function wsUrlForThread(threadId: string): string | null { wsUrlForThread", "description": "Constructs WebSocket URL for a specific thread.", "scope": "", "scopeKind": ""}, {"name": "async function http<T>(path: string, init?: RequestInit): Promise<T> { http", "description": "Performs HTTP fetch with configured API base URL.", "scope": "", "scopeKind": ""}, {"name": "export async function listThreads(orderId?: string): Promise<ChatThread[]> { listThreads", "description": "Lists existing chat threads, using backend API or local mock fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function getOrCreateThread(input: GetOrCreateThreadInput): Promise<ChatThread> { getOrCreateThread", "description": "Gets or creates a chat thread based on input parameters, with backend or local fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchMessages(threadId: string): Promise<ChatMessage[]> { fetchMessages", "description": "Fetches messages for a thread from backend or local mock.", "scope": "", "scopeKind": ""}, {"name": "export async function sendMessage(threadId: string, payload: { content: string }): Promise<ChatM/ sendMessage", "description": "Sends a message in a thread, with backend or local mock logic, including simulated reply.", "scope": "", "scopeKind": ""}, {"name": "export function subscribeToThread( subscribeToThread", "description": "Subscribes to real-time updates for a thread, using WebSocket if available, otherwise polling.", "scope": "", "scopeKind": ""}, {"name": "function notify(threadId: string, event: ThreadEvent) { notify", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["http", "loadAllMock", "saveMock", "getUserId", "notify", "isServer", "canUseWS"], "search-terms": ["Chat API", "WebSocket fallback", "localStorage mock", "thread subscription", "fetch message", "create thread", "send message"], "state": 2, "file_id": 40, "knowledge_revision": 190, "git_revision": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620", "revision_history": [{"134": ""}, {"190": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620"}], "ctags": [{"_type": "tag", "name": "API_BASE", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const API_BASE = normalizeBaseUrl(import.meta.env.VITE_API_BASE as string | undefined);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "CacheEntry", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^type CacheEntry = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "EventCallback", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^type EventCallback = (ev: ThreadEvent) => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "LS_MESSAGES_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const LS_MESSAGES_KEY = 'mock_chat_messages_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "LS_THREADS_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const LS_THREADS_KEY = 'mock_chat_threads_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "LS_USER_ID_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const LS_USER_ID_KEY = 'mock_chat_user_id_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "WS_ENV", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const WS_ENV = normalizeBaseUrl(import.meta.env.VITE_WS_URL as string | undefined);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "backoff", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    let backoff = 1000;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const base = WS_ENV || (API_BASE ? `${API_BASE.replace(\\/\\\\\\/+$\\/, '')}\\/ws` : '');$/", "language": "TypeScript", "kind": "constant", "scope": "wsUrlForThread", "scopeKind": "function"}, {"_type": "tag", "name": "cache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const cache = new Map<string, CacheEntry>();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "canUseWS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function canUseWS(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "cb", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  for (const cb of set) {$/", "language": "TypeScript", "kind": "constant", "scope": "notify", "scopeKind": "function"}, {"_type": "tag", "name": "ce", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^          const ce = cache.get(t.id)!;$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "ce", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const ce = cache.get(threadId) || null;$/", "language": "TypeScript", "kind": "constant", "scope": "fetchMessages", "scopeKind": "function"}, {"_type": "tag", "name": "ce", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const ce = cache.get(threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    const connect = () => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const d = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^          const data = JSON.parse(e.data) as ThreadEvent;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "deliveryPartner", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const deliveryPartner: Participant = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const existing = localStorage.getItem(LS_USER_ID_KEY);$/", "language": "TypeScript", "kind": "constant", "scope": "getUserId", "scopeKind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const existing = threads.find((t) => {$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "fetchMessages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^export async function fetchMessages(threadId: string): Promise<ChatMessage[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getOrCreateThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^export async function getOrCreateThread(input: GetOrCreateThreadInput): Promise<ChatThread> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getUserId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function getUserId(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "http", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^async function http<T>(path: string, init?: RequestInit): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const id = `u_${nanoid(8)}`;$/", "language": "TypeScript", "kind": "constant", "scope": "getUserId", "scopeKind": "function"}, {"_type": "tag", "name": "input", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    const rid = input.restaurantId ? input.restaurantId : 'global';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const items = await http<ChatThread[]>(`\\/chat\\/threads${q}`);$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "listThreads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^export async function listThreads(orderId?: string): Promise<ChatThread[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "listeners", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^const listeners = new Map<string, Set<EventCallback>>();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "loadAllMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function loadAllMock(): { threads: ChatThread[]; messages: Record<string, ChatMessage[]> } {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "m1", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const m1: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "m2", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const m2: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "maxBackoff", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    const maxBackoff = 10000;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "me", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const me: Participant = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "meId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const meId = getUserId();$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "meId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const meId = getUserId();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const messages = readLS<Record<string, ChatMessage[]>>(LS_MESSAGES_KEY, {});$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const messages: Record<string, ChatMessage[]> = {};$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const { messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "fetchMessages", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const msg = await http<ChatMessage>(`\\/chat\\/threads\\/${encodeURIComponent(threadId)}\\/mes/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "msgs", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const msgs = await http<ChatMessage[]>(`\\/chat\\/threads\\/${encodeURIComponent(threadId)}\\//", "language": "TypeScript", "kind": "constant", "scope": "fetchMessages", "scopeKind": "function"}, {"_type": "tag", "name": "myMsg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const myMsg: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeBaseUrl", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function normalizeBaseUrl(v?: string): string | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "notify", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function notify(threadId: string, event: ThreadEvent) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const now = new Date();$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const now = new Date();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const now = new Date();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "participants", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const participants: Participant[] = [$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "q", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const q = orderId ? `?orderId=${encodeURIComponent(orderId)}` : '';$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "readLS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function readLS<T>(key: string, fallback: T): T {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "reply", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const reply: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const res = await fetch(`${API_BASE}${path}`, {$/", "language": "TypeScript", "kind": "constant", "scope": "http", "scopeKind": "function"}, {"_type": "tag", "name": "rid", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    const rid = input.restaurantId ? input.restaurantId : 'global';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    { id: meId, role: 'user', displayName: 'You', presence: 'online' },$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "saveMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function saveMock($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "seedMockIfEmpty", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function seedMockIfEmpty() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "sendMessage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^export async function sendMessage(threadId: string, payload: { content: string }): Promise<ChatM/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "set", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const set = listeners.get(threadId);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "set", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const set = listeners.get(threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "notify", "scopeKind": "function"}, {"_type": "tag", "name": "startPolling", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const startPolling = (intervalMs: number) => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const status: ConnectionStatus = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "subscribeToThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^export function subscribeToThread($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "support", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const support: Participant = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const t = await http<ChatThread>('\\/chat\\/thread', {$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    const t = localStorage.getItem(key);$/", "language": "TypeScript", "kind": "constant", "scope": "readLS", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const t = threads.find((x) => x.id === threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const t: ChatThread = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "t1", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const t1: ChatThread = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "t2", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const t2: ChatThread = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "teardownFns", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const teardownFns: Array<() => void> = [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const threads = readLS<ChatThread[]>(LS_THREADS_KEY, []);$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const threads = readLS<ChatThread[]>(LS_THREADS_KEY, []);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const { threads } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "transport", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    transport: 'mock',$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "tt", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^      const tt = d.threads.find((x) => x.id === threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    const u = new URL(v, 'http:\\/\\/localhost');$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeBaseUrl", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const url = new URL(base);$/", "language": "TypeScript", "kind": "constant", "scope": "wsUrlForThread", "scopeKind": "function"}, {"_type": "tag", "name": "userIdMemo", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^let userIdMemo: string | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "void", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^  const teardownFns: Array<() => void> = [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "writeLS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function writeLS<T>(key: string, value: T) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^    let ws: WebSocket | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "wsUrlForThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^function wsUrlForThread(threadId: string): string | null {$/", "language": "TypeScript", "kind": "function"}], "hash": "5881e377ffde49925ea8320746d4ee63", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/chatApi.ts", "fields": [{"name": "let backoff = 1000;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let userIdMemo: string | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let ws: WebSocket | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}]}