{"is_source_file": true, "format": "TypeScript", "description": "This file implements a Chat API service with functions for listing, creating, fetching, and sending messages in chat threads. It supports WebSocket and polling fallback, with localStorage-backed mock data for offline or SSR environments.", "external_files": ["@/types/chat", "./helpersRuntime", "./runtimeConfig"], "external_methods": ["nanoid", "isServer", "shouldUseWebsocket", "getWsUrl", "getApiBase"], "published": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "classes": [], "methods": [{"name": "normalizeBaseUrl", "description": "Normalizes a URL string, allowing relative paths and validating URL format."}, {"name": "getUserId", "description": "Retrieves or generates a unique user ID, stored in localStorage unless on server."}, {"name": "readLS", "description": "Reads and parses data from localStorage with fallback."}, {"name": "writeLS", "description": "Stringifies and writes data to localStorage."}, {"name": "seedMockIfEmpty", "description": "Initializes mock chat threads and messages in localStorage if none exist."}, {"name": "loadAllMock", "description": "Loads all mock chat threads and messages from localStorage."}, {"name": "saveMock", "description": "Saves chat threads and messages to localStorage."}, {"name": "canUseWS", "description": "Determines if WebSocket can be used based on environment and config."}, {"name": "wsUrlForThread", "description": "Constructs WebSocket URL for a given thread ID."}, {"name": "http", "description": "Performs an HTTP fetch request to the backend API."}, {"name": "listThreads", "description": "Lists chat threads, optionally filtered by orderId, with backend or mock fallback."}, {"name": "getOrCreateThread", "description": "Retrieves or creates a chat thread based on input parameters, with backend or mock fallback."}, {"name": "fetchMessages", "description": "Fetches messages for a thread, with backend or mock fallback."}, {"name": "sendMessage", "description": "Sends a message in a thread, with backend or mock fallback, including simulated reply."}, {"name": "notify", "description": "Notifies subscribers of thread events."}, {"name": "subscribeToThread", "description": "Subscribes to thread events via WebSocket or polling, with auto-retry and cleanup."}], "calls": ["getWsUrl", "getApiBase", "shouldUseWebsocket", "fetch", "loadAllMock", "saveMock", "http", "setInterval", "clearInterval", "setTimeout", "loadAllMock", "notify"], "search-terms": ["chat", "WebSocket", "polling", "localStorage", "mock data", "thread", "message", "subscribe", "SSR", "fallback"], "state": 2, "file_id": 40, "knowledge_revision": 305, "git_revision": "abecf9ced63be25963010603f6ddbe44f472819d", "revision_history": [{"134": ""}, {"190": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620"}, {"198": "ef85c21ea4ed8dfbec99666038bc8f94558191b0"}, {"305": "abecf9ced63be25963010603f6ddbe44f472819d"}], "ctags": [], "filename": "food_ordering_frontend/src/services/chatApi.ts", "format-version": 4, "code-base-name": "https://github.com/kavia-common/easy-food-order-221713-221722.git:kavia-main"}