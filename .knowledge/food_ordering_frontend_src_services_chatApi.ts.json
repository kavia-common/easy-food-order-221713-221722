{"is_source_file": true, "format": "TypeScript", "description": "This file provides a chat API service module that manages chat threads, messages, and subscriptions. It supports backend API interactions and a mock local storage fallback for testing or offline use. It includes functions for listing, creating, fetching, sending messages, and subscribing to real-time updates via WebSocket or polling fallback. It is tailored for a food ordering frontend chat feature, distinguishing itself by handling mock data seeds, WebSocket URL generation, and local storage management.", "external_files": ["@/types/chat", "./helpersRuntime", "./runtimeConfig"], "external_methods": ["nanoid", "isServer", "shouldUseWebsocket", "getWsUrl", "getApiBase"], "published": ["listThreads", "getOrCreateThread", "fetchMessages", "sendMessage", "subscribeToThread"], "classes": [], "methods": [{"name": "function normalizeBaseUrl(v?: string): string | undefined { normalizeBaseUrl", "description": "Normalizes URL strings, allowing relative paths and validating URL format.", "scope": "", "scopeKind": ""}, {"name": "export async function listThreads(orderId?: string): Promise<ChatThread[]> { listThreads", "description": "Lists existing chat threads, optionally filtered by orderId, using backend API or mock fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function getOrCreateThread(input: GetOrCreateThreadInput): Promise<ChatThread> { getOrCreateThread", "description": "Retrieves an existing thread or creates a new one based on input parameters, with backend API or mock fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function fetchMessages(threadId: string): Promise<ChatMessage[]> { fetchMessages", "description": "Fetches messages for a specific thread, using backend API or mock fallback.", "scope": "", "scopeKind": ""}, {"name": "export async function sendMessage(threadId: string, payload: { content: string }): Promise<Chat/ sendMessage", "description": "Sends a message to a thread, updating cache and simulating a reply in mock mode, with optional backend API.", "scope": "", "scopeKind": ""}, {"name": "export function subscribeToThread( subscribeToThread", "description": "Subscribes to real-time updates for a thread via WebSocket or polling, with automatic reconnection and cleanup.", "scope": "", "scopeKind": ""}, {"name": "function canUseWS(): boolean { canUseWS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function getUserId(): string { getUserId", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function http<T>(path: string, init?: RequestInit): Promise<T> { http", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function loadAllMock(): { threads: ChatThread[]; messages: Record<string, ChatMessage[]> } { loadAllMock", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function notify(threadId: string, event: ThreadEvent) { notify", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function readLS<T>(key: string, fallback: T): T { readLS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function saveMock( saveMock", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function seedMockIfEmpty() { seedMockIfEmpty", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function writeLS<T>(key: string, value: T) { writeLS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function wsUrlForThread(threadId: string): string | null { wsUrlForThread", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["http", "loadAllMock", "saveMock", "getUserId", "notify", "canUseWS", "wsUrlForThread"], "search-terms": ["chatApi", "websocket", "mock_chat_threads", "localStorage", "subscribeToThread", "getOrCreateThread", "fetchMessages", "sendMessage", "listThreads"], "state": 2, "file_id": 40, "knowledge_revision": 198, "git_revision": "ef85c21ea4ed8dfbec99666038bc8f94558191b0", "revision_history": [{"134": ""}, {"190": "f2f4d922f67e5b031c3258a21a1f9e1775cb2620"}, {"198": "ef85c21ea4ed8dfbec99666038bc8f94558191b0"}], "ctags": [{"_type": "tag", "name": "API_BASE", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const API_BASE = normalizeBaseUrl(getBackendBase());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "CacheEntry", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ type CacheEntry = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "EventCallback", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ type EventCallback = (ev: ThreadEvent) => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "LS_MESSAGES_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const LS_MESSAGES_KEY = 'mock_chat_messages_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "LS_THREADS_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const LS_THREADS_KEY = 'mock_chat_threads_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "LS_USER_ID_KEY", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const LS_USER_ID_KEY = 'mock_chat_user_id_v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "WS_ENV", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const WS_ENV = normalizeBaseUrl(getWsUrl());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "backoff", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     let backoff = 1000;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const base = WS_ENV || (API_BASE ? `${String(API_BASE).replace(\\/\\\\\\/*$\\/, '')}\\/ws` : '');$/", "language": "TypeScript", "kind": "constant", "scope": "wsUrlForThread", "scopeKind": "function"}, {"_type": "tag", "name": "cache", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const cache = new Map<string, CacheEntry>();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "canUseWS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function canUseWS(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "cb", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   for (const cb of set) {$/", "language": "TypeScript", "kind": "constant", "scope": "notify", "scopeKind": "function"}, {"_type": "tag", "name": "ce", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^           const ce = cache.get(t.id)!;$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "ce", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const ce = cache.get(threadId) || null;$/", "language": "TypeScript", "kind": "constant", "scope": "fetchMessages", "scopeKind": "function"}, {"_type": "tag", "name": "ce", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const ce = cache.get(threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     const connect = () => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const d = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^           const data = JSON.parse(e.data) as ThreadEvent;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "deliveryPartner", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const deliveryPartner: Participant = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const existing = threads.find((t) => {$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const existing = typeof localStorage !== 'undefined' ? localStorage.getItem(LS_USER_ID_KEY) :/", "language": "TypeScript", "kind": "constant", "scope": "getUserId", "scopeKind": "function"}, {"_type": "tag", "name": "fetchMessages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ export async function fetchMessages(threadId: string): Promise<ChatMessage[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getOrCreateThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ export async function getOrCreateThread(input: GetOrCreateThreadInput): Promise<ChatThread> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getUserId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function getUserId(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "http", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ async function http<T>(path: string, init?: RequestInit): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const id = `u_${nanoid(8)}`;$/", "language": "TypeScript", "kind": "constant", "scope": "getUserId", "scopeKind": "function"}, {"_type": "tag", "name": "input", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     const rid = input.restaurantId ? input.restaurantId : 'global';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const items = await http<ChatThread[]>(`\\/chat\\/threads${q}`);$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "listThreads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ export async function listThreads(orderId?: string): Promise<ChatThread[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "listeners", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ const listeners = new Map<string, Set<EventCallback>>();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "loadAllMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function loadAllMock(): { threads: ChatThread[]; messages: Record<string, ChatMessage[]> } {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "m1", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const m1: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "m2", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const m2: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "maxBackoff", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     const maxBackoff = 10000;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "me", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const me: Participant = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "meId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const meId = getUserId();$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "meId", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const meId = getUserId();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const messages = readLS<Record<string, ChatMessage[]>>(LS_MESSAGES_KEY, {});$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const messages: Record<string, ChatMessage[]> = {};$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const { messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "fetchMessages", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const msg = await http<ChatMessage>(`\\/chat\\/threads\\/${encodeURIComponent(threadId)}\\/me/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "msgs", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const msgs = await http<ChatMessage[]>(`\\/chat\\/threads\\/${encodeURIComponent(threadId)}\\//", "language": "TypeScript", "kind": "constant", "scope": "fetchMessages", "scopeKind": "function"}, {"_type": "tag", "name": "myMsg", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const myMsg: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeBaseUrl", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function normalizeBaseUrl(v?: string): string | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "notify", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function notify(threadId: string, event: ThreadEvent) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const now = new Date();$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const now = new Date();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const now = new Date();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "participants", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const participants: Participant[] = [$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "q", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const q = orderId ? `?orderId=${encodeURIComponent(orderId)}` : '';$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "readLS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function readLS<T>(key: string, fallback: T): T {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "reply", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const reply: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const res = await fetch(`${API_BASE}${path}`, {$/", "language": "TypeScript", "kind": "constant", "scope": "http", "scopeKind": "function"}, {"_type": "tag", "name": "rid", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     const rid = input.restaurantId ? input.restaurantId : 'global';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     { id: meId, role: 'user', displayName: 'You', presence: 'online' },$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "saveMock", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function saveMock($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "seedMockIfEmpty", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function seedMockIfEmpty() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "sendMessage", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ export async function sendMessage(threadId: string, payload: { content: string }): Promise<Chat/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "set", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const set = listeners.get(threadId);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "set", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const set = listeners.get(threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "notify", "scopeKind": "function"}, {"_type": "tag", "name": "startPolling", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const startPolling = (intervalMs: number) => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const status: ConnectionStatus = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "subscribeToThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ export function subscribeToThread($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "support", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const support: Participant = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const t = await http<ChatThread>('\\/chat\\/thread', {$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     const t = localStorage.getItem(key);$/", "language": "TypeScript", "kind": "constant", "scope": "readLS", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const t = threads.find((x) => x.id === threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const t: ChatThread = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "t1", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const t1: ChatThread = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "t2", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const t2: ChatThread = {$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "teardownFns", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const teardownFns: Array<() => void> = [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const threads = readLS<ChatThread[]>(LS_THREADS_KEY, []);$/", "language": "TypeScript", "kind": "constant", "scope": "seedMockIfEmpty", "scopeKind": "function"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const threads = readLS<ChatThread[]>(LS_THREADS_KEY, []);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const { threads } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "listThreads", "scopeKind": "function"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "getOrCreateThread", "scopeKind": "function"}, {"_type": "tag", "name": "threads", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const { threads, messages } = loadAllMock();$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "transport", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     transport: 'mock',$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "tt", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^       const tt = d.threads.find((x) => x.id === threadId);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessage", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const url = new URL(base, typeof window !== 'undefined' ? window.location.origin : 'http:\\/\\//", "language": "TypeScript", "kind": "constant", "scope": "wsUrlForThread", "scopeKind": "function"}, {"_type": "tag", "name": "userIdMemo", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ let userIdMemo: string | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "void", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^   const teardownFns: Array<() => void> = [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "writeLS", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function writeLS<T>(key: string, value: T) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^     let ws: WebSocket | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "wsUrlForThread", "path": "/home/kavia/workspace/code-generation/easy-food-order-221713-221722/food_ordering_frontend/src/services/chatApi.ts", "pattern": "/^ function wsUrlForThread(threadId: string): string | null {$/", "language": "TypeScript", "kind": "function"}], "hash": "86f3279e2d78b1b22ee2c5d6e54f9838", "format-version": 4, "code-base-name": "food_ordering_frontend", "filename": "food_ordering_frontend/src/services/chatApi.ts", "fields": [{"name": "let backoff = 1000;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let userIdMemo: string | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let ws: WebSocket | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}]}